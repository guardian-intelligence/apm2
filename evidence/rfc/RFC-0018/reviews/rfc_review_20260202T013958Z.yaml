schema_version: "1.0.0"
rfc_id: RFC-0018
review_timestamp: "2026-02-02T01:39:58Z"
review_type: REMEDIATION
previous_review: "rfc_review_20260202T000000Z.yaml"
previous_verdict: APPROVED_WITH_REMEDIATION

remediation_session:
  mode: REMEDIATE
  instruction_spec: "dcp://apm2.local/instructions/rfc_council/remediate_mode@v0"
  council_protocol: "dcp://apm2.local/instructions/rfc_council/council_protocol@v0"

findings_remediated:
  - finding_id: FND-RFC-0018-004
    gate_id: GATE-TCK-IMPLEMENTABILITY
    category: IMPLEMENTABILITY_DEFECT
    subcategory: OPEN_QUESTION_BLOCKING
    severity: MAJOR
    original_status: OPEN
    new_status: RESOLVED_PROVISIONAL
    remediation_action: |
      Resolved Q-HEF-0001 with Option A (add episode_id field to existing events).
      Decision deadline moved from 2026-02-15 to 2026-02-05.
      Added resolution block with rationale, implementation guidance, and evidence refs.
    files_modified:
      - "documents/rfcs/RFC-0018/08_risks_and_open_questions.yaml"
      - "documents/rfcs/RFC-0018/06_ticket_decomposition.yaml (TCK-00306 preconditions)"
    verification:
      - "YAML syntax validated"
      - "Q-HEF-0001 resolution is actionable and specific"
      - "TCK-00306 summary updated to reference Option A"

  - finding_id: FND-RFC-0018-005
    gate_id: GATE-TCK-IMPLEMENTABILITY
    category: IMPLEMENTABILITY_DEFECT
    subcategory: INTERFACE_UNDERSPECIFIED
    severity: MAJOR
    original_status: OPEN
    new_status: RESOLVED_PROVISIONAL
    remediation_action: |
      Added post_commit_notification_interface specification to TCK-00304 with:
      - CommitNotification struct definition
      - Channel-based pattern (tokio::sync::mpsc::Sender)
      - Error handling semantics (fire-and-forget, LOG_WARN_DROP)
      - Channel capacity (1024) and non-blocking guarantee
      - Integration point (BftLedgerBackend::on_commit())
      - Updated acceptance criteria (7 criteria total)
    files_modified:
      - "documents/rfcs/RFC-0018/06_ticket_decomposition.yaml"
    verification:
      - "YAML syntax validated"
      - "Interface is fully specified (signature, pattern, error handling)"
      - "No daemon type dependencies in CommitNotification"

  - finding_id: FND-RFC-0018-001
    gate_id: GATE-TCK-CCP-MAPPING
    category: COVERAGE_DEFECT
    subcategory: PATH_AMBIGUITY
    severity: MINOR
    original_status: OPEN
    new_status: RESOLVED_PROVISIONAL
    remediation_action: |
      Clarified TCK-00314 module structure with:
      - Explicit confirmation that evidence/mod.rs exists
      - cas_access.rs placement as submodule of evidence
      - Added sole-entry-point constraint for security
    files_modified:
      - "documents/rfcs/RFC-0018/06_ticket_decomposition.yaml"
    verification:
      - "YAML syntax validated"
      - "Module path confirmed: crates/apm2-daemon/src/evidence/mod.rs exists"

  - finding_id: FND-RFC-0018-002
    gate_id: GATE-TCK-ATOMICITY
    category: ATOMICITY_DEFECT
    subcategory: LARGE_SCOPE
    severity: MINOR
    original_status: OPEN
    new_status: ACKNOWLEDGED
    remediation_action: |
      Acknowledged large scope warning for TCK-00306. Per council review:
      - Q-HEF-0001 resolution (Option A) reduces scope (field addition vs new events)
      - Split into TCK-00306a/b is optional optimization
      - Current scope is acceptable given proto+daemon changes are co-dependent
    files_modified: []
    verification:
      - "TCK-00306 scope reduced by Option A selection"

  - finding_id: FND-RFC-0018-003
    gate_id: GATE-TCK-ATOMICITY
    category: ATOMICITY_DEFECT
    subcategory: DEPENDENCY_CHAIN
    severity: MINOR
    original_status: OPEN
    new_status: ACKNOWLEDGED
    remediation_action: |
      Acknowledged dependency chain for TCK-00311. Per original finding:
      "Acceptable given FAC v0 precondition sequencing; document critical path."
      No remediation needed; dependency chain is inherent to FAC v0 preconditions.
    files_modified: []
    verification:
      - "Critical path documented in ticket decomposition"

  - finding_id: FND-RFC-0018-006
    gate_id: GATE-TCK-ANTI-COUSIN
    category: COUSIN_DEFECT
    subcategory: ABSTRACTION_DRIFT_RISK
    severity: MINOR
    original_status: OPEN
    new_status: RESOLVED_PROVISIONAL
    remediation_action: |
      Added anti-pattern note AP-HEF-0008-001 to DD-HEF-0008 with:
      - 5-point prohibition list (no persistence, no delivery guarantees, etc.)
      - Cousin path documentation (buffer -> queue -> broker -> authority leak)
      - Prevention guidance (ledger catch-up is ONLY recovery mechanism)
      - Detection trigger (code review flag on disk I/O in pulse buffer)
    files_modified:
      - "documents/rfcs/RFC-0018/02_design_decisions.yaml"
    verification:
      - "YAML syntax validated"
      - "Anti-pattern covers all evolution vectors"
      - "Prohibition is explicit and enforceable"

verdict: APPROVED
verdict_reason: |
  All MAJOR findings (FND-RFC-0018-004, FND-RFC-0018-005) have been remediated with
  RESOLVED_PROVISIONAL status. Q-HEF-0001 is resolved with Option A, and the post-commit
  notification interface is fully specified. MINOR findings are either RESOLVED_PROVISIONAL
  or ACKNOWLEDGED as acceptable given the RFC scope.

  RFC-0018 is now ready for implementation. Implementation should:
  1. Follow Q-HEF-0001 resolution (add episode_id to existing Session/Tool events)
  2. Implement CommitNotification interface per TCK-00304 specification
  3. Respect AP-HEF-0008-001 anti-pattern constraints for replay buffer

council_metadata:
  session_id: COUNCIL-RFC-0018-REMEDIATE-20260202-013958
  mode: REMEDIATE
  subagents:
    - agent_id: SA-1
      role: Structural Rigorist
      anchor_modes: [70, 44]
      random_modes: [6, 15, 36]
      contribution: |
        Proposed Option B (new Episode* events) for Q-HEF-0001; proposed
        PostCommitNotifier trait; drafted DD-HEF-0007 interface specification.
    - agent_id: SA-2
      role: Implementation Feasibility
      anchor_modes: [40, 51]
      random_modes: [11, 78, 63]
      contribution: |
        Recommended Option A (add episode_id field) via satisficing analysis;
        designed channel-based CommitNotification interface; provided causal
        chain analysis for fix dependencies.
    - agent_id: SA-3
      role: Security Guardian
      anchor_modes: [79, 36]
      random_modes: [8, 65, 55]
      contribution: |
        Drafted AP-HEF-0008-001 anti-pattern note with 5-point prohibition;
        identified cousin path (buffer -> broker -> authority leak);
        added sole-entry-point constraint for cas_access.rs.
  dialectical_resolution:
    topic: "Q-HEF-0001: Option A vs Option B"
    thesis: "SA-1: Option B (new Episode* events) per existing truth_plane_preconditions"
    antithesis: "SA-2: Option A (add field) via satisficing analysis (minimal change)"
    synthesis: "Option A adopted; existing Session/Tool events have mapping infrastructure"
  cycles_completed: 3
  findings_processed: 6
  findings_resolved: 4
  findings_acknowledged: 2
  quorum_achieved: true
