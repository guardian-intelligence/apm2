$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://apm2.dev/schemas/apm2/review_blocked_v1.yaml"
title: "ReviewBlockedV1"
description: "CAS-hosted blocked outcome bundle for FAC v0 review liveness failures."
type: "object"
required:
  - schema
  - schema_version
  - blocked_id
  - changeset_digest
  - reason_code
  - blocked_log_hash
  - time_envelope_ref
properties:
  schema:
    type: "string"
    const: "apm2.review_blocked.v1"
  schema_version:
    type: "string"
    pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
  blocked_id:
    type: "string"
    minLength: 1
    maxLength: 128
  changeset_digest:
    type: "string"
    pattern: "^[a-f0-9]{64}$"
  reason_code:
    type: "string"
    enum:
      - "APPLY_FAILED"
      - "TOOL_FAILED"
      - "BINARY_UNSUPPORTED"
      - "MISSING_ARTIFACT"
      - "INVALID_BUNDLE"
      - "TIMEOUT"
      - "POLICY_DENIED"
      - "CONTEXT_MISS"
  blocked_log_hash:
    type: "string"
    description: "Hex-encoded 32-byte BLAKE3 hash of blocked logs stored in CAS."
    pattern: "^[a-f0-9]{64}$"
  time_envelope_ref:
    type: "string"
    description: "Hex-encoded 32-byte hash of TimeEnvelope stored in CAS."
    pattern: "^[a-f0-9]{64}$"
unevaluatedProperties: false
