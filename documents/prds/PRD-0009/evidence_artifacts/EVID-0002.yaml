prd_evidence_artifact:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "EVID-0002"
  category: "INTEGRATION_TEST_RESULTS"
  title: "Context Miss and Refinement Loop Tests"
  description: |
    Tests verifying context miss handling and refinement loop triggering.
    Context misses must terminate session with rationale=CONTEXT_MISS and trigger
    pack recompilation. GateRunCompleted must not be emitted when context is absent.
  source_acceptance_test: FAC-AT-0002
  capture:
    paths:
      - "test/fac/context_miss/"
      - "test/fac/refinement_loop/"
  verification:
    commands:
      - id: "CMD-0001"
        shell: "bash"
        command: "cargo test --workspace -- context_miss::session_termination"
        expected_exit_code: 0
        cwd: "."
        timeout_seconds: 180
        network_access: "DISALLOWED"
        allowlist_hosts: []
        constraints:
          - "Session coordinator available for spawn/terminate"
          - "ContextRefinementRequest event schema configured"
  assertions:
    - "SessionTerminated emitted with rationale=CONTEXT_MISS when required context absent"
    - "GateRunCompleted is never emitted when context miss occurs"
    - "ContextRefinementRequest triggers pack recompilation"
    - "Coordinator reissues lease after refined pack is produced"
  data:
    classification: "INTERNAL"
    redaction:
      required: false
      guidance: []
