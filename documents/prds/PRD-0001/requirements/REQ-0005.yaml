prd_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: REQ-0005
  type: COMPLIANCE
  title: Deterministic policy evaluation and provenance
  statement: 'Policy evaluation MUST be deterministic, reproducible, and attributable:
    every tool decision MUST record the policy rule ID, policy configuration hash,
    and budget deltas; policy configuration changes MUST be versioned and recorded
    in the ledger.'
  acceptance_criteria:
  - For each tool request, the system records a TOOL.DECIDED event with decision,
    rule_id, reason_code, and policy_hash.
  - Given the same inputs and policy_hash, the policy engine produces the same decision
    deterministically.
  - Policy configurations are schema-validated before activation and are referenced
    by content hash.
  - Policy changes are applied only via explicit configuration activation events and
    are audit logged.
  - A verifier can replay policy decisions from the ledger without contacting external
    services.
  evidence:
    evidence_ids:
    - EVID-0003
    - EVID-0004
