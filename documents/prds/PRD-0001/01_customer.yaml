prd_customer:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  segments:
  - id: CUST-0001
    name: Factory coordination substrate (Supervisor)
    description: The top-level holonic node or agent quorum responsible for initiating
      outcomes, managing budgets, and adjudicating high-level decisions.
    primary_jobs_to_be_done:
    - Initiate autonomous workflows from high-level PRD/RFC objectives.
    - Resolve adjudication requests via quorum when child agents hit bounded choices.
    - Maintain factory throughput by applying deterministic fallbacks during timeouts.
    constraints:
    - Must not require real-time human intervention to maintain engineering progress.
    - All governance decisions must be signed and recorded to the ledger.
  - id: CUST-0002
    name: Autonomous authority quorum
    description: A designated group of authority-capable agents responsible for evaluating
      evidence, signing gates, and issuing waivers via N-of-M consensus.
    primary_jobs_to_be_done:
    - Adjudicate complex design or security trade-offs presented as bounded choices.
    - Sign off on evidence bundles to satisfy gate reviews and closure requirements.
    - Monitor for policy violations and trigger remediation sub-work.
    constraints:
    - Decisions must be reproducible from the provided evidence and decision artifacts.
    - Quorum must respond within configured deadlines or defer to kernel fallback.
  stakeholder_entities:
  - id: STKH-0001
    name: Source control and code hosting service
    entity_type: EXTERNAL_SYSTEM
    description: The system that stores repositories, pull requests, and merge operations.
      Interactions are mediated by APM2 tools and audited.
    constraints:
    - 'No implicit trust: operations require explicit credentials and policy grants.'
    - Operations must be reproducible and logged (PR fetch, diff, merge, revert).
  - id: STKH-0002
    name: CI/CD execution environment
    entity_type: EXTERNAL_SYSTEM
    description: Compute used for deterministic builds, tests, and verification commands.
      May be local or remote depending on profile.
    constraints:
    - Verification commands must declare network_access; default is DISALLOWED.
    - Build/test outputs must be captured as evidence artifacts.
  - id: STKH-0003
    name: Inference provider substrate
    entity_type: INTERNAL_COMPONENT
    description: A pluggable inference provider (local model, delegated node, or remote
      API) invoked only via the mediated infer syscall with budgets and logging.
    constraints:
    - Provider selection is policy-driven and can be changed without altering work
      logic.
    - Inference requests/responses are handled under redaction and classification
      policy.
  user_journeys:
  - id: UJ-0001
    name: Single-command autonomous change from spec to merge
    steps:
    - Operator or supervising agent defines outcome by providing PRD/RFC references
      and a target repository/branch.
    - Invoke a single factory command that starts coordination, spawns worker sessions,
      and opens work contracts.
    - Agents refine PRD/RFC artifacts as needed and emit questions as typed work items
      when inputs are missing.
    - System decomposes into tickets, claims leases, executes changes under mediated
      tools, and produces evidence.
    - Reviewer agents validate diffs against requirements and evidence, then perform
      merge or explicit abort.
    - System publishes evidence bundle and updates projections/metrics.
    failure_modes:
    - 'No eligible agent capacity available: work remains OPEN and is retried when
      capacity returns.'
    - 'Policy denies required action: work transitions to NEEDS_INPUT with required
      permission/evidence.'
    - 'Agent session stalls or crashes: supervisor restarts with backoff; leases expire
      and fail over deterministically.'
    - 'Merge blocked by failing evidence: work remains in REVIEW until evidence is
      produced or waived.'
    observability_notes:
    - Operator can query active leases, session health, and evidence completeness
      by work_id.
    - Every tool action and policy decision is attributable to a session and lease
      and is replayable from the ledger.
    - Cost and throughput metrics are exported to dashboards and can be recomputed
      from projections.
  - id: UJ-0002
    name: Partition and recovery without silent success
    steps:
    - A child node loses connectivity to its parent or peers while holding active
      work leases.
    - Child continues only with already-held authority and local policy; new authority
      cannot be minted.
    - Child spools events and evidence outputs locally under the ledger.
    - Upon reconnection, child synchronizes ledger segments by cursor and resolves
      any detected conflicts deterministically.
    - If conflict requires adjudication, system opens a new work item requiring authority
      review.
    failure_modes:
    - 'Clock skew causes early/late lease expiration: slack rules prevent premature
      takeover; conflicts are explicit.'
    - 'Simultaneous claims after partition: conflict is recorded and resolved under
      configured rule set.'
    observability_notes:
    - Link up/down events are recorded; replication lag is measurable.
    - Conflict counts and resolution outcomes are tracked as metrics.
