rfc_design_decisions:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  decisions:
  - id: DEC-RFC-0002-001
    title: "Use cargo-xtask Pattern"
    statement: |
      Implement development scripts as a cargo xtask crate with clap-based subcommands,
      following the pattern established in documents/skills/xtask-scripting/SKILL.md.
    context: |
      Development automation needs to be typesafe, testable, and cross-platform.
      The xtask pattern is the Rust ecosystem standard for this use case.
    alternatives:
    - id: ALT-0001
      name: "Keep bash scripts"
      pros:
      - "No migration effort"
      - "Familiar to most developers"
      cons:
      - "Not typesafe"
      - "Not cross-platform"
      - "Hard to test"
      - "Duplicate code patterns"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Debugging shell scripts is harder than Rust code"
    - id: ALT-0002
      name: "Use Python scripts"
      pros:
      - "Cross-platform"
      - "Easy to write"
      cons:
      - "Adds runtime dependency"
      - "Not as typesafe as Rust"
      - "Another language in the codebase"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Python version management"
    - id: ALT-0003
      name: "Use cargo-xtask pattern (chosen)"
      pros:
      - "Typesafe with compile-time checks"
      - "Cross-platform via xshell"
      - "Testable with standard Rust testing"
      - "Single language for entire project"
      - "Shared utilities reduce duplication"
      cons:
      - "Migration effort required"
      - "Slightly more verbose than bash"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Requires cargo to run scripts"
    chosen_rationale: |
      The xtask pattern aligns with our Rust-first codebase and provides the typesafety,
      testability, and cross-platform support that bash scripts lack. The xshell crate
      provides ergonomic command execution while maintaining safety.
    impacted_requirement_ids: []
    evidence_ids: []

  - id: DEC-RFC-0002-002
    title: "Shared Utility Module"
    statement: |
      Create a shared utility module with common functions for branch validation,
      worktree management, and ticket path construction.
    context: |
      The 5 bash scripts share significant duplicate code for parsing branch names,
      finding the main worktree, and constructing paths to ticket YAML files.
    alternatives:
    - id: ALT-0001
      name: "Inline utilities in each command"
      pros:
      - "Each command is self-contained"
      cons:
      - "Code duplication"
      - "Inconsistent implementations"
      security_tradeoffs: []
      operability_tradeoffs: []
    - id: ALT-0002
      name: "Shared utility module (chosen)"
      pros:
      - "DRY principle"
      - "Single source of truth for patterns"
      - "Easier to test"
      - "Consistent behavior across commands"
      cons:
      - "Slightly more complex module structure"
      security_tradeoffs: []
      operability_tradeoffs: []
    chosen_rationale: |
      Shared utilities eliminate duplication and ensure consistent behavior. The
      branch name regex, worktree path finding, and ticket YAML path construction
      are used by multiple commands and should be centralized.
    impacted_requirement_ids: []
    evidence_ids: []

  - id: DEC-RFC-0002-003
    title: "Command Naming Convention"
    statement: |
      Map script names to xtask subcommands using short, verb-first names:
      start-ticket, commit, push, check, finish.
    context: |
      The current scripts use verbose names like `start-eng-ticket.sh`. The xtask
      pattern favors shorter subcommand names since they're already namespaced
      under `cargo xtask`.
    alternatives:
    - id: ALT-0001
      name: "Keep verbose names (start-eng-ticket)"
      pros:
      - "Familiar to existing users"
      cons:
      - "Unnecessarily verbose"
      - "Redundant with 'xtask' context"
      security_tradeoffs: []
      operability_tradeoffs: []
    - id: ALT-0002
      name: "Short verb-first names (chosen)"
      pros:
      - "Concise"
      - "Follows CLI conventions"
      - "Easy to type"
      cons:
      - "Users must learn new names"
      security_tradeoffs: []
      operability_tradeoffs: []
    chosen_rationale: |
      Short names improve ergonomics and follow standard CLI conventions. The
      mapping is straightforward and will be documented clearly.
    impacted_requirement_ids: []
    evidence_ids: []

  command_mapping:
    description: "Mapping from old bash scripts to new xtask commands"
    mappings:
    - old: "./scripts/dev/start-eng-ticket.sh RFC-0001"
      new: "cargo xtask start-ticket RFC-0001"
    - old: "./scripts/dev/commit-eng-ticket.sh \"message\""
      new: "cargo xtask commit \"message\""
    - old: "./scripts/dev/push-eng-ticket.sh"
      new: "cargo xtask push"
    - old: "./scripts/dev/check-eng-ticket.sh"
      new: "cargo xtask check"
    - old: "./scripts/dev/finish-eng-ticket.sh"
      new: "cargo xtask finish"
