rfc_requirement:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  id: "REQ-HEF-0004"
  type: "RELIABILITY"
  title: "Resource governance and drop policy"
  statement: |
    The daemon must enforce per-connection caps (subscriptions, patterns,
    pulses/sec, queue depth, bytes in-flight) with bounded drop policy. Drops
    must prefer non-critical topics (episode.<id>.io first).
  acceptance_criteria:
    - "Exceeding caps returns RESOURCE_LIMIT and does not crash daemon."
    - "Drop ordering follows defined priority under backpressure."
    - "Caps enforced: max_subscriptions_per_connection=16; max_patterns_per_subscription=16; max_total_patterns_per_connection=64."
    - "Caps enforced: max_pulses_per_sec_per_subscriber=100; max_burst_pulses_per_subscriber=200; max_queue_depth_per_subscriber=256; max_bytes_in_flight_per_subscriber=1048576; max_pulse_payload_bytes=2048."
  evidence:
    evidence_ids:
      - "EVID-HEF-0007"
    inherited_from_prd: false
    notes: []
