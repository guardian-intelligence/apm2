rfc_rollout_and_ops:
  schema_version: "2026-02-01"
  template_version: "2026-01-23"
  rollout_plan:
    phases:
      - id: "ROL-HEF-0001"
        name: "Phase 1A - Disabled by default (shadow emit)"
        steps:
          - "Implement PulseEnvelope + Subscribe/Unsubscribe surfaces (no default enable)."
          - "Emit pulses to internal sink for metrics only; no external subscribers."
        guardrails:
          - "Red-team suite complete and passing (EVID-HEF-0001..0007)."
          - "Drop rate < 5% under synthetic load."
        rollback_steps:
          - "Disable pulse publisher feature flag; clear queues; keep ledger-only." 
        evidence_ids:
          - "EVID-HEF-0007"
      - id: "ROL-HEF-0002"
        name: "Phase 1B - Operator-only subscriptions"
        steps:
          - "Enable subscriptions on operator.sock only."
          - "Restrict to system/work/gate/defect topics by default."
        guardrails:
          - "Unauthorized subscribe attempts return PERMISSION_DENIED."
          - "Pulse size and queue caps enforced."
          - "Projection-only posture enforced; xtask direct GitHub status writes disabled or routed via daemon (TCK-00309)."
          - "FAC v0 gate evidence requires RFC-0017 prerequisites: TCK-00254, TCK-00256, TCK-00260."
          - "Enable-by-default is blocked until GATE-HEF-PROJECTION-ONLY and GATE-HEF-FAC-V0 pass."
        rollback_steps:
          - "Disable operator subscriptions; revert to Phase 1A shadow emit."
        evidence_ids:
          - "EVID-HEF-0002"
      - id: "ROL-HEF-0003"
        name: "Phase 1C - Session-limited subscriptions"
        steps:
          - "Enable session.sock subscriptions limited to capability-manifest allowlists (episode/work/gate scopes)."
          - "Reject wildcard or broad patterns on session.sock in Phase 1; capability manifests must enumerate exact topics."
        guardrails:
          - "Session token validation enforced before ACL evaluation."
          - "Per-connection resource caps enforced."
          - "FAC v0 gate evidence requires RFC-0017 prerequisites: TCK-00254, TCK-00256, TCK-00260."
          - "Enable-by-default is blocked until GATE-HEF-PROJECTION-ONLY and GATE-HEF-FAC-V0 pass."
        rollback_steps:
          - "Disable session subscriptions; keep operator subscriptions."
        evidence_ids:
          - "EVID-HEF-0002"
  operability:
    runbooks:
      - "HEF-OPS-001: Disable pulse publisher on saturation or suspected misuse."
      - "HEF-OPS-002: Reconcile subscriber state after daemon restart (ledger catch-up)."
      - "HEF-OPS-003: Investigate repeated ACL denials (possible attack)."
    alarms:
      - "Pulse queue depth > 80% for 60s"
      - "Pulse drop rate > 5% for 5m"
      - "ACL denials > 100/minute"
    automated_response_notes:
      - "If queue depth alarm triggers, reduce per-subscriber rate or disable pulse plane."
  observability:
    metrics:
      - "hef_pulses_emitted_total"
      - "hef_pulses_dropped_total{reason}"
      - "hef_pulses_queue_depth"
      - "hef_subscriptions_active"
      - "hef_acl_denied_total"
    logs:
      - "Pulse subscription granted/denied with reason code (no sensitive data)."
      - "Pulse publish errors with topic and cursor only."
    traces:
      - "Pulse publish path spans (ledger commit -> outbox -> publish)."
    audit_events:
      - "SubscribePulseRequest accepted/denied"
      - "PulsePlane disabled/enabled"
