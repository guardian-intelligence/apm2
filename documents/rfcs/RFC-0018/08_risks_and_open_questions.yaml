rfc_risks_and_open_questions:
  schema_version: "2026-02-01"
  template_version: "2026-01-23"
  risks:
    - id: "RSK-HEF-0001"
      statement: "Missing truth-plane events for episode lifecycle/tool/io and defect records prevent required Phase-1 topics from being emitted."
      impact: "HEF topics would be partial; consumers forced back to polling."
      likelihood: "HIGH"
      mitigations:
        - "TCK-00306 adds episode lifecycle/tool/io events to kernel_events.proto."
        - "TCK-00307 adds DefectRecorded ledger event."
      evidence_ids:
        - "EVID-HEF-0006"
    - id: "RSK-HEF-0002"
      statement: "Pulse hints could be misused as authoritative admission signals."
      impact: "Admission bypass or spoofed gate outcomes."
      likelihood: "MEDIUM"
      mitigations:
        - "REQ-HEF-0001 forbids authoritative use; red-team tests enforce fail-closed."
        - "DD-HEF-0001 + DD-HEF-0008 explicitly prohibit pulse-only decisions."
      evidence_ids:
        - "EVID-HEF-0001"
    - id: "RSK-HEF-0003"
      statement: "Pulse fanout may introduce DoS risk to daemon (queue growth, CPU)."
      impact: "Control-plane degradation or outage."
      likelihood: "MEDIUM"
      mitigations:
        - "REQ-HEF-0004 caps queues, rates, and in-flight bytes."
        - "Drop policy prioritizes critical topics."
      evidence_ids:
        - "EVID-HEF-0007"
    - id: "RSK-HEF-0004"
      statement: "Legacy bypass surfaces (xtask GitHub status writes) may be mistakenly treated as truth."
      impact: "Projection-only posture violated; split-brain admission."
      likelihood: "MEDIUM"
      mitigations:
        - "HEF explicitly forbids using GitHub status or pulses as authority."
        - "TCK-00309 removes or routes direct GitHub status writes through daemon projection logic."
      evidence_ids:
        - "EVID-HEF-0001"
    - id: "RSK-HEF-0005"
      statement: "FAC v0 autonomy preconditions (ChangeSetBundle, ReviewReceipt, ReviewBlocked) may be missing, forcing GitHub reads or stalling reviews."
      impact: "Reviewer liveness fails or authority leaks to external projections."
      likelihood: "HIGH"
      mitigations:
        - "TCK-00310..TCK-00313 implement FAC v0 preconditions and tests."
        - "FAC v0 evidence depends on RFC-0017 tickets TCK-00254, TCK-00256, and TCK-00260 (capability manifest, SpawnEpisode, tool broker)."
        - "GATE-HEF-FAC-V0 blocks enable-by-default until evidence exists."
      evidence_ids:
        - "EVID-HEF-0012"
    - id: "RSK-HEF-0006"
      statement: "Reviewer tool surface mismatch (missing ListFiles/Search) may block autonomous review navigation."
      impact: "Reviewers cannot locate files or verify context; autonomy stalls."
      likelihood: "MEDIUM"
      mitigations:
        - "TCK-00315 adds ListFiles/Search tool surfaces with allowlist enforcement."
      evidence_ids:
        - "EVID-HEF-0011"
    - id: "RSK-HEF-0007"
      statement: "Large changesets may exceed ChangeSetBundle file_manifest limits and be blocked in v0."
      impact: "Reviews stall for extremely large PRs until partitioning/streaming is available."
      likelihood: "MEDIUM"
      mitigations:
        - "ReviewBlocked with reason_code=INVALID_BUNDLE provides explicit failure + evidence."
        - "Future work may add streaming/partitioned bundles beyond v0."
      evidence_ids: []
  open_questions:
    - id: "Q-HEF-0001"
      question: "Should episode_id be added to existing Session/Tool kernel events, or should new Episode* events be added?"
      decision_needed_by: "2026-02-05"
      resolution_plan: "Prototype both schema options; select minimal-change path that preserves replay determinism."
      resolution:
        status: RESOLVED
        choice: "OPTION_A_ADD_FIELD"
        date: "2026-02-02"
        rationale: |
          Option A (add episode_id field to existing events) is selected based on satisficing analysis:
          1. Non-breaking proto change (optional field addition to ~7 messages)
          2. Existing ledger events replay correctly (episode_id defaults to empty)
          3. Daemon already maps episode_id <-> session_id (apm2d_runtime_v1.proto:35-36)
          4. Single code path: populate episode_id at daemon emission time
          5. Topic derivation uses existing event types with episode_id field extraction

          Option B (new Episode* events) was considered but rejected because it
          requires new event types, new emission paths, and correlation logic
          between Episode* and existing Session/Tool events.
        implementation_guidance: |
          Add optional string episode_id to: SessionStarted, SessionProgress,
          SessionTerminated, SessionQuarantined, ToolRequested, ToolDecided, ToolExecuted.
          Daemon populates episode_id from episode context when emitting ledger events.
          Pulse topic derivation extracts episode_id from events.
        evidence_refs:
          - "apm2d_runtime_v1.proto:35-36 (existing episode_id/session_id mapping)"
          - "SA-2 satisficing analysis (FND-RFC-0018-004 remediation)"
    - id: "Q-HEF-0002"
      question: "Should DefectRecord be embedded directly in ledger events or stored in CAS with hash reference?"
      decision_needed_by: "2026-02-15"
      resolution_plan: "Compare size and disclosure impact; choose CAS reference if payload risk is high."
    - id: "Q-HEF-0003"
      question: "Do we require a small in-memory pulse replay buffer for short reconnects, or force pure ledger catch-up?"
      decision_needed_by: "2026-02-20"
      resolution_plan: "Define operator UX needs; keep buffer optional and non-authoritative if added."
      resolution:
        status: RESOLVED
        choice: "OPTIONAL_NON_AUTHORITATIVE_BUFFER"
        date: "2026-02-02"
        rationale: |
          FINALIZE council determined this question was already answered by DD-HEF-0008
          and AP-HEF-0008-001. The design explicitly specifies:
          1. Replay buffer is OPTIONAL
          2. Buffer is non-authoritative (ephemeral, in-memory only)
          3. Ledger catch-up via since_ledger_cursor is the ONLY recovery mechanism
          4. Buffer MUST NOT be persisted or provide delivery guarantees
          5. Target: <5 seconds of buffered history only
        implementation_guidance: |
          Buffer implementation is optional. If implemented, MUST comply with
          AP-HEF-0008-001 constraints. TCK-00308 red-team suite MUST include tests
          for buffer authority leakage.
    - id: "Q-HEF-0004"
      question: "Should ReviewReceiptRecorded be a new kernel event, or should review success be represented via GateReceipt evidence bundles only?"
      decision_needed_by: "2026-02-20"
      resolution_plan: "Compare schema churn vs audit clarity; keep v0 path consistent with FAC receipt semantics."
      resolution:
        status: RESOLVED
        choice: "NEW_KERNEL_EVENT"
        date: "2026-02-02"
        rationale: |
          FINALIZE council determined this was falsely open - the design had already committed:
          1. FAC-V0-003 explicitly requires "ReviewReceiptRecorded ledger event referencing CAS hash"
          2. TCK-00312 specifies ReviewReceiptRecorded event implementation
          3. Distinct event provides audit clarity and requirement fidelity (REQ-HEF-0011)
          4. ReviewReceipt serves different purpose than GateReceipt (anchors reviewer outputs vs gate decisions)
        implementation_guidance: |
          TCK-00312 implements ReviewReceiptRecorded as specified. Event MUST bind to
          changeset_digest and ReviewArtifactBundleV1 CAS hash per acceptance criteria.
    - id: "Q-HEF-0005"
      question: "Should changeset_digest remain embedded in ChangeSetBundle (Option A) or move to ledger event only (Option B)?"
      decision_needed_by: "2026-02-22"
      resolution_plan: "For v0, keep Option A to align with CAS/EventHasher BLAKE3 hashing and single canonical bundle witness; reconsider Option B only if ledger-only binding demonstrably simplifies validation and avoids redundancy."
      resolution:
        status: RESOLVED
        choice: "OPTION_A_EMBEDDED"
        date: "2026-02-02"
        rationale: |
          FINALIZE council determined Option A is structurally required by DD-HEF-0010:
          1. DD-HEF-0010 specifies "changeset_digest computed as BLAKE3-256 over canonical
             bundle bytes with the changeset_digest field omitted from hash input"
          2. This specification REQUIRES the digest to be a field within the bundle
          3. Option B would break the self-referential canonicalization requirement
          4. Option A provides single canonical bundle witness with self-contained verification
        implementation_guidance: |
          TCK-00310 implements ChangeSetBundleV1 with changeset_digest field. Hash input
          MUST omit the changeset_digest field during BLAKE3 computation. Deterministic
          digest test validates same inputs produce same digest.
