evidence_artifact:
  schema_version: "2026-02-09"
  id: "EVID-0014"
  title: "Cryptographic proof verification, payload hash recomputation, and merge provenance checks for CRDT merge law"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that TCK-00360 security hardening is implemented in the CRDT
    merge module (crates/apm2-core/src/consensus/crdt.rs). Three BLOCKER
    findings and one MAJOR finding are addressed:

    BLOCKER 1 - AuthorizationProof cryptographic signature verification:
    Added AuthorizationVerifier trait (following taint::SignatureVerifier
    pattern) with fail-closed semantics. validate_integrity_with_verifier()
    accepts an optional &dyn AuthorizationVerifier and rejects proofs when
    the verifier returns false. When no verifier is provided, structural
    checks still apply (backward-compatible). All-zero signatures and
    policy-root hashes are rejected.

    BLOCKER 2 - CrdtDelta payload hash recomputation:
    Added validate_with_payload_check() that serializes the payload to
    canonical JSON bytes, computes BLAKE3 hash, and compares against the
    declared payload_hash. Rejects on mismatch with DeltaPayloadHashMismatch
    error. This prevents payload substitution attacks where the attacker
    swaps payload contents while keeping the original hash.

    BLOCKER 3 - Merge exception readmission provenance revalidation:
    Added validate_readmission_provenance() which checks that readmission
    anchors are self-consistent after deserialization. The
    check_readmission_exception() merge path now revalidates provenance
    before applying the RFC-0020 exception. Crafted serialized state with
    anchor but readmission_count=0, tampered anchor_hash, or
    effective_anchor > 0 without anchor is rejected (fail-closed to
    revoked state).

    MAJOR 1 - This evidence artifact (EVID-0014) documents the test
    outputs and artifact references.

  requirement_ids:
    - "REQ-0014"
  source_refs:
    - "documents/rfcs/RFC-0020/requirements/REQ-0014.yaml"
    - "crates/apm2-core/src/consensus/crdt.rs"
  artifacts:
    - type: "test_output"
      description: |
        BLOCKER 1: AuthorizationVerifier integration tests.
        - tck_00360_authorization_proof_verifier_approves
        - tck_00360_authorization_proof_verifier_rejects
        - tck_00360_authorization_proof_no_verifier_backward_compat
      ref:
        - "cargo test -p apm2-core -- tck_00360_authorization_proof_verifier_approves"
        - "cargo test -p apm2-core -- tck_00360_authorization_proof_verifier_rejects"
        - "cargo test -p apm2-core -- tck_00360_authorization_proof_no_verifier_backward_compat"
    - type: "test_output"
      description: |
        BLOCKER 2: CrdtDelta payload hash recomputation tests.
        - tck_00360_crdt_delta_payload_check_passes
        - tck_00360_crdt_delta_payload_check_rejects_tampered
        - tck_00360_crdt_delta_payload_check_also_validates_commitment
      ref:
        - "cargo test -p apm2-core -- tck_00360_crdt_delta_payload_check_passes"
        - "cargo test -p apm2-core -- tck_00360_crdt_delta_payload_check_rejects_tampered"
        - "cargo test -p apm2-core -- tck_00360_crdt_delta_payload_check_also_validates_commitment"
    - type: "test_output"
      description: |
        BLOCKER 3: Merge exception readmission provenance revalidation tests.
        - tck_00360_crafted_readmission_provenance_rejected
        - tck_00360_tampered_anchor_hash_rejected
        - tck_00360_effective_anchor_without_readmission_anchor_rejected
        - tck_00360_legitimate_readmission_passes_provenance
      ref:
        - "cargo test -p apm2-core -- tck_00360_crafted_readmission_provenance_rejected"
        - "cargo test -p apm2-core -- tck_00360_tampered_anchor_hash_rejected"
        - "cargo test -p apm2-core -- tck_00360_effective_anchor_without_readmission_anchor_rejected"
        - "cargo test -p apm2-core -- tck_00360_legitimate_readmission_passes_provenance"
    - type: "test_output"
      description: |
        New error variant display tests.
        - tck_00360_new_error_display (updated to cover DeltaPayloadHashMismatch and ReadmissionProvenanceInvalid)
      ref:
        - "cargo test -p apm2-core -- tck_00360_new_error_display"
