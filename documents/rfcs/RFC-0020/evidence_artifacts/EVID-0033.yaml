evidence_artifact:
  schema_version: "2026-01-23"
  id: "EVID-0033"
  title: "Attestation floor tightening by risk tier evidence"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that attestation floor enforcement implements RFC-0020 Section 6.5
    security properties:
    - Risk-tier-to-floor mapping matches RFC normative requirements
      (Tier0-1: None, Tier2: Soft, Tier3+: Strong)
    - Tier3+ requests below Strong attestation floor are denied (fail-closed)
    - Cross-cell imported facts below floor are quarantined (not silently accepted)
    - Floor evaluations produce auditable FloorEvaluation records for all outcomes
    - Delegation meet operator takes strictest floor (monotonic tightening)
    - Unknown/unrecognized attestation levels default to None (fail-closed)
    - Unknown high tiers (>4) map to Tier4 floor (fail-closed)
    - Non-monotonic floor configurations are rejected at construction time
    - Batch import evaluations are bounded (MAX_BATCH_EVALUATIONS = 10,000)
    - All string fields are bounded (actor_id, env_fingerprint, cell_id, etc.)
    - QuarantineRecord can only be created from failed cross-cell evaluations
    - Serialization roundtrips for all types (FloorEvaluation, QuarantineRecord,
      AttestationMetadata, AttestationFloorPolicy)
    - Exhaustive tier x level matrix test covering all combinations

    Covers attestation floor enforcement, cross-cell import quarantine,
    delegation meet anti-weakening, fail-closed semantics, bounded fields,
    and audit visibility.
  requirement_ids:
    - "REQ-0033"
  source_refs:
    - "crates/apm2-core/src/policy/attestation_floor.rs"
  artifacts:
    - type: "test_output"
      description: |
        Attestation floor tests:
        AttestationLevel ordering and properties:
        - attestation_level_ordering: None < Soft < Strong < HumanCosign
        - attestation_level_ordinal_roundtrip: from_ordinal/ordinal roundtrip for 0..=3
        - attestation_level_meets_floor: meets_floor correctness across all pairs
        - attestation_level_join: lattice join returns strictest level
        - attestation_level_meet: lattice meet returns weakest level
        - attestation_level_display: display strings match expected format
        - attestation_level_default: default is None
        - attestation_level_serde_roundtrip: JSON serialization roundtrip
        Policy configuration:
        - default_policy_matches_rfc_0020: default floors match Section 6.5
        - policy_tier_above_4_maps_to_tier4: unknown high tiers fail-closed
        - policy_rejects_non_monotonic_floors: non-monotonic rejected
        - policy_accepts_monotonic_floors: valid config accepted
        - policy_accepts_equal_floors: all-same floors accepted
        Tier request evaluations:
        - tier3_strong_attestation_passes: Strong meets Tier3 floor
        - tier3_soft_attestation_denied: Soft below Tier3 floor denied
        - tier3_none_attestation_denied: None below Tier3 floor denied
        - tier3_human_cosign_passes: HumanCosign exceeds Tier3 floor
        - tier0_none_attestation_passes: None meets Tier0 floor
        - tier2_soft_attestation_passes: Soft meets Tier2 floor
        - tier2_none_attestation_denied: None below Tier2 floor denied
        - tier4_strong_attestation_passes: Strong meets Tier4 floor
        - unknown_high_tier_uses_tier4_floor: tier=99 uses Tier4 floor
        Cross-cell import evaluations:
        - cross_cell_strong_passes: Strong meets import floor
        - cross_cell_soft_quarantined: Soft below import floor quarantined
        - cross_cell_none_quarantined: None below import floor quarantined
        - cross_cell_human_cosign_passes: HumanCosign exceeds import floor
        Quarantine records:
        - quarantine_record_from_failed_cross_cell: valid quarantine creation
        - quarantine_record_from_passing_eval_fails: passing eval rejected
        - quarantine_record_from_tier_eval_fails: tier eval rejected
        Guard integration:
        - guard_admit_tier_passes: guard delegates to policy correctly
        - guard_admit_tier_denied: guard propagates denial
        - guard_admit_cross_cell_passes: guard cross-cell pass
        - guard_admit_cross_cell_quarantined: guard cross-cell quarantine
        Batch evaluation:
        - batch_admit_cross_cell_evaluates_all: all imports evaluated
        - batch_admit_rejects_oversized_batch: bounded batch enforcement
        Metadata validation:
        - metadata_creation_valid: valid metadata accepted
        - metadata_rejects_oversized_actor_id: bounded field enforcement
        - metadata_rejects_oversized_env_fingerprint: bounded field enforcement
        - metadata_rejects_oversized_policy_root_key_id: bounded field enforcement
        - metadata_meets_floor: metadata floor check correctness
        Summary and display:
        - floor_evaluation_summary_pass: PASS summary format
        - floor_evaluation_summary_fail_deny: FAIL/DENY summary format
        - floor_evaluation_summary_fail_quarantine: FAIL/QUARANTINE summary format
        - evaluation_kind_display: display strings
        Delegation meet:
        - delegation_meet_takes_strictest_floor: join prevents weakening
        - delegation_cannot_weaken_attestation_floor: anti-laundering
        Fail-closed:
        - fail_closed_unknown_ordinal: out-of-range ordinal returns None
        - fail_closed_tier3_no_attestation: None denied at Tier3
        - fail_closed_cross_cell_no_attestation: None quarantined
        Serialization:
        - floor_evaluation_serde_roundtrip: JSON roundtrip
        - quarantine_record_serde_roundtrip: JSON roundtrip
        - attestation_metadata_serde_roundtrip: JSON roundtrip
        - policy_serde_roundtrip: JSON roundtrip
        Truncation:
        - long_actor_id_truncated_in_evaluation: bounded actor_id
        - long_cell_id_truncated_in_evaluation: bounded cell_id
        Exhaustive:
        - exhaustive_tier_level_matrix: all tier x level combinations checked
      ref: "cargo test -p apm2-core attestation_floor"
