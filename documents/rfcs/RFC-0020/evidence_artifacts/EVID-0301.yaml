evidence_artifact:
  schema_version: "2026-01-23"
  id: "EVID-0301"
  title: "HSI contract manifest fail-closed build enforcement evidence"
  category: "UNIT_TEST_RESULT"
  status: "PASS"
  description: |
    Evidence that missing route semantics annotations fail the manifest
    build. The registry builder derives routes mechanically from the
    dispatch enums (PrivilegedMessageType and SessionMessageType). Any
    route without a semantics annotation causes build_manifest() to return
    ManifestBuildError::MissingSemantics.
  requirement_ids:
    - "REQ-0001"
  source_refs:
    - "crates/apm2-daemon/src/hsi_contract/registry.rs"
    - "crates/apm2-daemon/src/hsi_contract/semantics.rs"
    - "crates/apm2-daemon/src/protocol/dispatch.rs"
    - "crates/apm2-daemon/src/protocol/session_dispatch.rs"
  artifacts:
    - type: "test_output"
      description: |
        Registry tests verify fail-closed enforcement:
        - build_manifest_succeeds: all routes have semantics annotations
        - privileged_routes_cover_dispatch_types: enum variants match manifest routes
        - session_routes_cover_dispatch_types: enum variants match manifest routes
        - all_authoritative_routes_require_receipts: no authoritative route lacks receipts
        - all_routes_have_unique_ids: no duplicate route IDs
        - all_routes_have_unique_routes: no duplicate route paths
        Semantics tests verify annotation coverage:
        - authoritative_routes_always_require_receipts: invariant holds for all routes
        - local_only_routes_are_advisory: shutdown/credentials are advisory
      ref: "cargo test -p apm2-daemon hsi_contract::registry && cargo test -p apm2-daemon hsi_contract::semantics"
