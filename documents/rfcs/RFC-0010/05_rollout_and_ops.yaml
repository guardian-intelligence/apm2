rfc_rollout_and_ops:
  schema_version: "2026-01-26"
  template_version: "2026-01-26"

  rollout_plan:
    phases:
      - phase_id: PHASE-1
        name: "Core Infrastructure"
        description: "Build foundational modules for determinism, CCP generation, and CLI scaffolding"
        entry_criteria:
          - "PRD-0005 approved"
          - "RFC-0010 approved"
        exit_criteria:
          - "determinism module passes all unit tests"
          - "CCP build command produces valid artifacts for this repository"
          - "CLI commands registered and --help works"
        tickets:
          - TCK-00110
          - TCK-00111
          - TCK-00112
          - TCK-00113

      - phase_id: PHASE-2
        name: "Impact Mapping and RFC Framing"
        description: "Build requirement-to-component mapping and RFC generation"
        entry_criteria:
          - "PHASE-1 complete"
          - "CCP artifacts available for PRD-0005"
        exit_criteria:
          - "Impact Map builds for PRD-0005"
          - "RFC framing produces valid skeleton"
          - "Path validation catches invalid references"
        tickets:
          - TCK-00114
          - TCK-00115

      - phase_id: PHASE-3
        name: "Ticket Emission and Lint"
        description: "Build ticket decomposition and clutter prevention lint rules"
        entry_criteria:
          - "PHASE-2 complete"
        exit_criteria:
          - "Ticket emit produces valid YAML tickets"
          - "LINT-0013, LINT-0014, LINT-0015 implemented"
          - "cargo xtask lint passes"
        tickets:
          - TCK-00116
          - TCK-00117

      - phase_id: PHASE-4
        name: "Model Routing and Manifests"
        description: "Build model routing infrastructure and run manifest signing"
        entry_criteria:
          - "PHASE-3 complete"
        exit_criteria:
          - "Routing profiles parse correctly"
          - "Run manifests include all required fields"
          - "End-to-end compile command works"
        tickets:
          - TCK-00118
          - TCK-00119
          - TCK-00120

      - phase_id: PHASE-5
        name: "Skills and Refactor Radar"
        description: "Update skill library and implement continuous refactoring"
        entry_criteria:
          - "PHASE-4 complete"
        exit_criteria:
          - "idea-compiler skill invokes CLI correctly"
          - "rfc-council skill requires CCP/Impact Map"
          - "Refactor Radar produces bounded recommendations"
        tickets:
          - TCK-00121
          - TCK-00122

  operational_considerations:
    monitoring:
      - metric: "compile_duration_seconds"
        description: "End-to-end compilation time"
        alert_threshold: "> 300 seconds"
      - metric: "stage_failure_count"
        description: "Failed stage executions by type"
        alert_threshold: "> 3 per hour"
      - metric: "lint_violation_count"
        description: "Lint failures by rule"
        alert_threshold: "None (informational)"

    observability:
      - "NDJSON event logs for all stages"
      - "Run manifests with timing breakdown"
      - "Exit codes mapped to failure classes"

    recovery:
      - scenario: "Compilation fails mid-run"
        procedure: |
          Partial artifacts remain in evidence/ but are not promoted to documents/.
          Re-run compilation with same inputs. Atomic writes ensure no partial files.
      - scenario: "Provider unavailable during model routing"
        procedure: |
          Compilation fails closed. Configure fallback in routing profile or wait for provider recovery.
      - scenario: "CCP out of date after code changes"
        procedure: |
          Re-run apm2 factory ccp build to regenerate CCP before compilation.

  success_metrics:
    - metric_id: SM-001
      name: "First-pass ticket success rate"
      target: ">= 80%"
      measurement: "Tickets merged without rework / Total tickets emitted"
    - metric_id: SM-002
      name: "Compilation determinism"
      target: "100% for structural content"
      measurement: "Identical outputs for identical inputs (excluding timestamps)"
    - metric_id: SM-003
      name: "Cousin abstraction detection"
      target: ">= 95% compliance"
      measurement: "Tickets with no COUSIN findings / Total tickets"
