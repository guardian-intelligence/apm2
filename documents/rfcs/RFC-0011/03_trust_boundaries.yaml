rfc_trust_boundaries:
  schema_version: "2026-01-27"
  template_version: "2026-01-27"
  rfc_id: RFC-0011

  trust_model: |
    CAC v1 operates under a threat model that assumes adversaries include state actors
    with advanced capabilities. The trust boundary is between:

    1. The apm2 binary (trusted, with embedded bootstrap)
    2. External inputs (untrusted until validated and canonicalized)

    All control artifacts must pass through admission gates before influencing execution.

  boundaries:
    - id: TB-0001
      name: Admission Gate
      description: |
        The admission gate is the sole entry point for artifacts to DCP.
        All artifacts are validated, canonicalized, and content-addressed before admission.
      trust_level: HIGH
      invariant: |
        INV-0002: No normative artifact influences execution without schema validation
        and canonicalization.
      threats:
        - Malformed JSON causing parser crashes
        - Schema bypass via unknown fields
        - Replay attacks with stale patches
        - Hash collision attacks
      mitigations:
        - SEC-CTRL-0001: Canonical JSON profile (no floats, bounded depth)
        - SEC-CTRL-0003: Schema strictness (unknown field rejection)
        - SEC-CTRL-0004: Signed ledger and CAS hashes
        - SEC-PROP-0002: Replay protection via expected_base_hash

    - id: TB-0002
      name: Bootstrap Trust Root
      description: |
        The bootstrap schema bundle is embedded and pinned by hash in the binary.
        It cannot be modified at runtime through the standard patch pipeline.
      trust_level: CRITICAL
      invariant: |
        CNS-0006: Bootstrap schema bundle is immutable via the standard patch pipeline.
      threats:
        - Binary tampering to replace bootstrap
        - Ledger/bootstrap incompatibility deadlock
        - Key compromise of emergency override authorities
      mitigations:
        - SEC-CTRL-0008: Bootstrap trust root immutability
        - CNS-0006 recovery_procedure: Bootstrap-safe-mode and tiered recovery
        - Emergency override with triple-signoff ceremony

    - id: TB-0003
      name: Consumption Mode Hermeticity
      description: |
        Consumption holons operate in a restricted mode where only preauthorized
        stable-ID fetches are permitted. Discretionary discovery is denied.
      trust_level: HIGH
      invariant: |
        INV-0003: No consumption holon uses open-ended discovery for context.
      threats:
        - Bypass via content-hash-only fetch (side channel)
        - Pack incomplete leading to escalation abuse
        - Policy misconfiguration allowing broad reads
      mitigations:
        - SEC-CTRL-0005: Hermetic runtime sandboxing
        - SEC-CTRL-0017: Content-hash-only fetch restriction
        - SEC-PROP-0003: Least privilege consumption

    - id: TB-0004
      name: Dependency Trust Boundary
      description: |
        Pack specs capture dependency_review_hash at review time. Compilation
        fails if resolved hash differs from reviewed hash.
      trust_level: HIGH
      invariant: |
        SEC-PROP-0006: Pack specs pin dependency hashes at review time; compilation rejects drift.
      threats:
        - Time-of-check-to-time-of-use (TOCTOU) injection
        - Dependency content modification between review and compilation
        - Malicious producer injecting artifacts
      mitigations:
        - SEC-CTRL-0014: Dependency trust boundary protection
        - SEC-CTRL-0015: Dependency hash drift auditing
        - CNS-0010: Pack provenance review requirements

    - id: TB-0005
      name: External Audit Sink
      description: |
        Emergency override events must be delivered to external audit system
        for accountability. Degraded mode allows local buffering.
      trust_level: MEDIUM
      invariant: |
        All emergency override attempts are logged externally for audit.
      threats:
        - Audit sink unavailability during emergency
        - Log tampering to hide override events
        - Replay of old signoffs
      mitigations:
        - SEC-CTRL-0011: Degraded audit mode with HMAC integrity
        - SEC-CTRL-0012: Bootstrap-safe-mode audit
        - Nonce registry prevents replay

  security_properties:
    - id: SEC-PROP-0001
      name: Fail-closed admission
      statement: Artifacts cannot enter DCP or influence execution unless validated and canonicalized.
      evidence_ids:
        - EVID-0002

    - id: SEC-PROP-0002
      name: Replay protection
      statement: All patch admissions require expected_base_hash matching current state.
      evidence_ids:
        - EVID-0003

    - id: SEC-PROP-0003
      name: Least privilege consumption
      statement: Consumption holons have deterministic reads only; no open-ended browsing.
      evidence_ids:
        - EVID-0005

    - id: SEC-PROP-0004
      name: End-to-end provenance
      statement: All state transitions are recorded as signed events referencing immutable hashes.
      evidence_ids:
        - EVID-0011

    - id: SEC-PROP-0005
      name: Algorithm agility
      statement: |
        Cryptographic mechanisms are versioned and upgradable. Hash algorithms MUST
        provide >=256-bit collision resistance or use hybrid classical+quantum-resistant scheme.
      evidence_ids:
        - EVID-0001
      upgrade_policy: |
        Bootstrap schema bundle upgrade MUST mandate hash algorithm upgrade when
        collision resistance degrades below 256-bit security level.

    - id: SEC-PROP-0006
      name: Dependency trust boundary integrity
      statement: Pack specs pin dependency hashes at review time; compilation rejects drift.
      evidence_ids:
        - EVID-0010

  threat_scenarios:
    - id: TS-0001
      name: Malicious patch injection
      description: Adversary submits patch that bypasses validation
      likelihood: MEDIUM
      impact: HIGH
      mitigations:
        - Schema strictness (unevaluatedProperties=false)
        - Replay protection via expected_base_hash
        - Signed admission receipts

    - id: TS-0002
      name: Bootstrap corruption
      description: Adversary modifies bootstrap to allow invalid schemas
      likelihood: LOW
      impact: CRITICAL
      mitigations:
        - Binary embedding (requires binary release to modify)
        - Startup verification fails if hash mismatch
        - Triple-signoff emergency override for recovery

    - id: TS-0003
      name: Capability manifest forgery
      description: Adversary claims capabilities not supported by binary
      likelihood: MEDIUM
      impact: HIGH
      mitigations:
        - AATReceipt bound to binary_hash
        - Selftests verify actual behavior
        - Agent verifies receipt hash before planning

    - id: TS-0004
      name: Pack miss escalation abuse
      description: Attacker exploits escalation mechanism to bypass hermeticity
      likelihood: LOW
      impact: MEDIUM
      mitigations:
        - Escalation requires authorized role (not self-escalation)
        - Bounded TTL (max 24h)
        - Audit events for all escalations
        - Escalation count metrics feed pack improvement
