rfc_risks_and_open_questions:
  schema_version: "2026-01-27"
  template_version: "2026-01-27"
  rfc_id: RFC-0011

  risks:
    - id: RSK-0001
      statement: Canonicalizer divergence causes hash drift across implementations or versions
      impact: Breaks CAS dedupe, provenance, and stable-ID pinning
      likelihood: MEDIUM
      severity: CRITICAL
      mitigations:
        - Golden test vectors committed and run in CI
        - Versioned canonicalizer; include canonicalizer_version in receipts
        - Cross-language compatibility tests if multiple implementations exist
        - Canonicalizer id recorded in artifact envelopes
      evidence_ids:
        - EVID-0001
      status: OPEN
      owner: TBD

    - id: RSK-0002
      statement: Schema strictness slows iteration during early adoption
      impact: Machines may fail admission frequently; frustration and workarounds
      likelihood: HIGH
      severity: MEDIUM
      mitigations:
        - Bootstrap with small schema set and evolve intentionally
        - Provide machine-generated patch tooling that auto-validates before submission
        - Use staged rollout with warn, soft-fail, and hard-fail phases (TRADEOFF-0001)
      evidence_ids:
        - EVID-0002
      tradeoff_cluster: STRICTNESS_VS_VELOCITY
      status: MITIGATED_BY_DESIGN
      owner: TBD

    - id: RSK-0003
      statement: Target delivery churn breaks export pipeline due to vendor changes
      impact: External agent tooling stops working or requires urgent changes
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Version target profiles and pin in packs
        - Conformance tests run in AAT; failures become defects
        - Maintain fallback exports for critical vendors
      evidence_ids:
        - EVID-0006
      status: OPEN
      owner: TBD

    - id: RSK-0004
      statement: Consumption hermeticity causes early friction as packs are incomplete
      impact: Tasks fail because packs are incomplete; perceived as regressions
      likelihood: HIGH
      severity: MEDIUM
      mitigations:
        - Treat failures as compiler defects and fix packs quickly
        - Allow limited, explicitly budgeted escape hatches with strong defect emission
        - Prioritize pack completeness for most common workflows
        - Feedback SLA: 24h during rollout, 48h post-rollout
      evidence_ids:
        - EVID-0005
        - EVID-0010
      tradeoff_cluster: STRICTNESS_VS_VELOCITY
      status: MITIGATED_BY_DESIGN
      owner: TBD

    - id: RSK-0005
      statement: Indexing DCP from ledger becomes a performance bottleneck at scale
      impact: Stable-ID resolution and fetch becomes slow; consumption holons blocked
      likelihood: MEDIUM
      severity: HIGH
      mitigations:
        - Maintain a cached projection store (rebuildable from ledger)
        - Shard by namespace/kind; keep hot indexes in memory
        - Include compaction checkpoints
      evidence_ids:
        - EVID-0004
      status: OPEN
      owner: TBD

    - id: RSK-0006
      statement: Patch soup without compaction leads to unbounded history growth
      impact: Review and replay become slow or error-prone
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Define compaction thresholds (depth/time/size) per artifact kind
        - Require ChangeSet summaries to accompany compaction snapshots
        - Maintain provenance links from snapshots back to patch chains
      evidence_ids:
        - EVID-0003
      status: OPEN
      owner: TBD
      related_question: Q-0007

    - id: RSK-0007
      statement: Target profile miscalibration causes frequent failures for weaker models
      impact: Context budgets or rendering policies miscalibrated; tasks fail
      likelihood: MEDIUM
      severity: MEDIUM
      mitigations:
        - Default to conservative budgets; adjust via measured RunReceipt data
        - Maintain per-model profiles and gate by capability manifest
        - Automate profile tuning based on sufficiency metrics
      evidence_ids:
        - EVID-0009
      status: OPEN
      owner: TBD

    - id: RSK-0008
      statement: Bootstrap/ledger incompatibility creates deadlock during upgrades
      impact: Neither old nor new binary can operate; system unavailable
      likelihood: LOW
      severity: CRITICAL
      mitigations:
        - Pre-upgrade compatibility check (apm2 upgrade --check-compatibility)
        - Bootstrap-safe-mode for diagnostics
        - Emergency override with triple-signoff ceremony
        - Tiered recovery protocol (TIER_1 through TIER_4)
        - Rollback compatibility matrix
      evidence_ids:
        - EVID-0008
      status: MITIGATED_BY_DESIGN
      owner: TBD

  open_questions:
    - id: Q-0001
      question: |
        Exact canonicalization spec: strict RFC 8785 JCS vs a stricter CAC profile;
        how to publish, pin, and version test vectors and canonicalizer IDs?
      decision_needed_by: Phase 1 (Foundations)
      resolution_plan: |
        Define CAC-specific deviations from JCS (if any). Publish test vectors as
        governed artifacts in bootstrap bundle. Record canonicalizer_id in all receipts.
      priority: CRITICAL
      status: OPEN
      assigned_to: TBD

    - id: Q-0002
      question: |
        Stable ID namespace governance: who can mint namespaces, and how are
        collisions prevented across org/projects?
      decision_needed_by: Phase 2 (Admission + Provenance)
      resolution_plan: |
        Define namespace minting policy. Consider hierarchical namespaces with
        org/project prefixes. Implement collision detection in admission gate.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0003
      question: |
        Do we need typed kernel events (ControlArtifactEvent) in the MVP, or is
        EvidencePublished metadata sufficient?
      decision_needed_by: Phase 2 (Admission + Provenance)
      resolution_plan: |
        Start with EvidencePublished metadata. Evaluate queryability and policy
        enforcement needs post-MVP. Add typed events if metadata proves insufficient.
      priority: MEDIUM
      status: DEFERRED
      deferral_rationale: |
        Out-of-scope for MVP per PRD non-goals. EvidencePublished metadata is
        sufficient for initial implementation.
      assigned_to: N/A

    - id: Q-0004
      question: |
        How to represent large binary artifacts within CAC-JSON (likely via CAS
        refs only) and enforce policies consistently?
      decision_needed_by: Phase 3 (Deterministic Fetch)
      resolution_plan: |
        Define a blob reference schema that includes CAS hash and size bounds.
        Policy enforces max size; large artifacts are stored in CAS, not inline.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0005
      question: |
        Should defect records be first-class kernel events or remain evidence
        artifacts referenced by events?
      decision_needed_by: Phase 4 (ContextPack Compiler)
      resolution_plan: |
        Start with defects as evidence artifacts. Evaluate whether first-class
        events improve queryability and recurrence detection.
      priority: MEDIUM
      status: OPEN
      assigned_to: TBD

    - id: Q-0006
      question: |
        TargetProfile schema: what is the minimal stage taxonomy (plan/implement/
        review/ops) and which policies must be mandatory vs optional?
      decision_needed_by: Phase 5 (Target Delivery)
      resolution_plan: |
        Define minimal stage set based on current workflows. Make budget policies
        mandatory; rendering policies optional with defaults.
      priority: HIGH
      status: OPEN
      assigned_to: TBD

    - id: Q-0007
      question: |
        Compaction policy: when does patch depth require snapshotting, and how
        are ChangeSet summaries preserved across compaction?
      decision_needed_by: Post-MVP
      resolution_plan: |
        Define compaction thresholds based on observed patch depths. Require
        ChangeSet summaries as compaction inputs. Maintain provenance links.
      priority: LOW
      status: DEFERRED
      deferral_rationale: |
        Post-MVP enhancement. Initial implementation can accept unbounded patch
        history with periodic manual compaction.
      assigned_to: N/A

  known_unknowns:
    description: |
      This section documents areas requiring codebase investigation before design
      can be finalized. These "Known Unknowns" will be resolved during v2 Exploration.

    codebase_discovery_needed:
      - area: Canonicalizer integration
        question: How does new CAC canonicalizer relate to existing determinism/canonicalize.rs?
        investigation_target: crates/apm2-core/src/determinism/canonicalize.rs
        hypothesis: May need to extend or replace existing canonicalization

      - area: Ledger event emission
        question: What event families exist and how to add CAC-specific events?
        investigation_target: crates/apm2-core/src/events/
        hypothesis: Extend existing apm2.kernel.v1 event family

      - area: Policy engine integration
        question: How to integrate consumption mode restrictions with existing policy engine?
        investigation_target: crates/apm2-core/src/policy/engine.rs
        hypothesis: Add new policy rules for ArtifactFetch restrictions

      - area: Tool protocol extension
        question: How to add ArtifactFetch to existing tool protocol?
        investigation_target: crates/apm2-core/src/tool/
        hypothesis: Extend apm2.tool.v1 protocol with new tool type

      - area: Holon episode integration
        question: How to emit RunReceipts from holon execution?
        investigation_target: crates/apm2-holon/src/episode/controller.rs
        hypothesis: Add receipt emission at episode completion

      - area: Build.rs bootstrap embedding
        question: How to embed bootstrap schema bundle at build time?
        investigation_target: crates/apm2-core/build.rs
        hypothesis: Use include_bytes! with hash verification

      - area: AAT harness integration
        question: How does new selftest harness relate to existing xtask/src/aat module?
        investigation_target: xtask/src/aat/
        hypothesis: Extend existing AAT infrastructure with CAC-specific tests
