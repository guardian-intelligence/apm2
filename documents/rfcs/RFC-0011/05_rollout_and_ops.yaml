rfc_rollout_and_ops:
  schema_version: "2026-01-27"
  template_version: "2026-01-27"
  rfc_id: RFC-0011

  rollout_strategy: |
    CAC v1 follows a graduated rollout strategy (TRADEOFF-0001 CONFIG-GRADUATED)
    balancing security/determinism with adoption velocity. The rollout spans 4 phases
    over approximately 49 days, with data-driven acceleration possible.

  phases:
    - phase_id: CAC-R-01
      name: Warn-only linting
      duration_days: 7
      mode: WARN
      description: |
        Warn-only linting + bootstrap schemas. All violations logged but not blocking.
        Establishes baseline metrics for CAC-M-LEAD-0003 (admission rejection rate).
      entry_criteria:
        - CAC canonicalizer implementation complete
        - CAC validator implementation complete
        - Bootstrap schema bundle embedded in binary
        - Linting CLI command available (apm2 cac lint)
      exit_criteria:
        - Baseline admission rejection rate established
        - No critical bugs in canonicalizer/validator
        - Canonicalization test vectors pass 100%
      monitoring:
        - Linting violation counts by category
        - Canonicalizer performance (throughput, latency)
        - Schema coverage of existing artifacts
      rollback_trigger:
        - Canonicalizer produces non-deterministic results
        - "More than 50% of existing artifacts fail validation"

    - phase_id: CAC-R-02
      name: Admission enforcement
      duration_days: 14
      mode: ADMISSION_FAIL
      description: |
        Admission pipeline enabled; fail on admission violations for new artifacts.
        Existing artifacts grandfathered until migration.
      entry_criteria:
        - Phase CAC-R-01 exit criteria met
        - Patch engine implementation complete
        - AdmissionReceipt emission working
        - DCP index bootstrapped from ledger
      exit_criteria:
        - New artifact admission success rate >90%
        - Replay protection verified (no stale patch accepted)
        - AdmissionReceipts verifiable in CAS
      monitoring:
        - Admission success/failure rates
        - Replay violation counts
        - Patch latency (p50, p95, p99)
      rollback_trigger:
        - Admission success rate <70%
        - Critical workflows blocked by admission

    - phase_id: CAC-R-03
      name: Consumption enforcement
      duration_days: 14
      mode: CONSUMPTION_FAIL
      description: |
        Hermetic consumption + run receipt gating. Fail on discretionary reads.
        ContextPack compiler available; initial packs compiled.
      entry_criteria:
        - Phase CAC-R-02 exit criteria met
        - ArtifactFetch tool implementation complete
        - ContextPack compiler implementation complete
        - RunReceipt emission working
        - Initial packs compiled for critical workflows
      exit_criteria:
        - CAC-M-LEAD-0002 (pack completeness) >85%
        - CAC-M-LEAD-0004 (miss rate) <2 per run
        - DefectRecord emission for pack misses working
      monitoring:
        - Pack completeness rate (context_pack_sufficiency)
        - Pack miss rate per run
        - Escalation frequency
        - Defect signatures and recurrence
      rollback_trigger:
        - Pack completeness <50%
        - "More than 10% task failure rate due to pack incompleteness"

    - phase_id: CAC-R-04
      name: Release gating
      duration_days: 14
      mode: RELEASE_FAIL
      description: |
        Target delivery + capabilities gating. Fail on export drift.
        Require AATReceipt for cutovers.
      entry_criteria:
        - Phase CAC-R-03 exit criteria met
        - Target profile schema finalized
        - Export pipeline implementation complete
        - AAT/selftest harness implementation complete
        - CapabilityManifest generation working
      exit_criteria:
        - Export determinism verified (byte-identical)
        - AAT pass rate >95%
        - Agent planning gates on AATReceipt
        - Conformance tests passing for all target profiles
      monitoring:
        - Export determinism violations
        - AAT pass/fail rates
        - CapabilityManifest generation frequency
        - Agent planning success rate
      rollback_trigger:
        - Export determinism failures >5%
        - AAT pass rate <80%

  acceleration_clause: |
    If CAC-M-LEAD-0002 (pack completeness) >85% at week 5, advance to CAC-R-03/04
    acceleration. Data-driven acceleration rewards faster-than-expected adoption.

  operational_considerations:
    feedback_sla:
      during_rollout: "24h standard, 4h emergency"
      post_rollout: "48h standard, 4h emergency"

    defect_aggregation_triggers:
      - id: TRIGGER-SIGNATURE-THRESHOLD
        condition: "Same defect signature occurs >=3 times within 7 days"
        action: "Emit PACK_SPEC_REVIEW_NEEDED event"
      - id: TRIGGER-ESCALATION-FREQUENCY
        threshold: ">=2 escalations for same stable_id within 14 days"
        action: "Emergency pack review"

    escape_hatches:
      - description: "Bounded escalation (max 24h TTL, audit required)"
        audit_requirement: EscalationAuditEvent
        authorized_roles: [AUTH_OPS, AUTH_PRODUCT]
      - description: "Emergency override with dual-signoff"
        audit_requirement: EmergencyOverrideEvent
        authorized_roles: [AUTH_OPS, AUTH_SECURITY]

  monitoring_and_alerting:
    leading_metrics:
      - metric_id: CAC-M-LEAD-0001
        name: Unplanned context reads
        target: "<5 per 1000 work items within 6 months"
        alert_threshold: ">10 per 100 work items (warn), >20 (critical)"

      - metric_id: CAC-M-LEAD-0002
        name: ContextPack completeness rate
        target: ">=95% within 3 months"
        alert_threshold: "<80% (warn), <60% (critical)"

      - metric_id: CAC-M-LEAD-0003
        name: Admission rejection rate
        target: "<10% within 3 months"
        alert_threshold: ">30% (warn), >50% (critical)"

      - metric_id: CAC-M-LEAD-0004
        name: ContextPack miss rate
        target: "<0.5 misses per run within 6 months"
        alert_threshold: ">2 per run (warn), >5 (critical)"

    lagging_metrics:
      - metric_id: CAC-M-LAG-0001
        name: PR cycle time
        target: ">=15% reduction within 3 months"
        measurement: "Stratified by PR complexity and work type"

      - metric_id: CAC-M-LAG-0002
        name: Defect recurrence rate
        target: "<5 recurring signatures per 1000 work items"
        measurement: "Jaccard similarity clustering of defect signatures"

    guardrail_alerts:
      - guardrail_id: GRD-0001
        name: Bootstrap trust root integrity
        alert: "CRITICAL: Startup failure due to bootstrap verification"
        response: "Requires binary update. No runtime recovery."

      - guardrail_id: GRD-0002
        name: Canonicalization determinism
        alert: "CRITICAL: Hash drift detected"
        response: "Immediate investigation. Canonicalizer version audit."

      - guardrail_id: GRD-0005
        name: Export determinism
        alert: "WARN: Export drift detected"
        response: "Block release until conformance test passes."

  disaster_recovery:
    bootstrap_failure:
      symptom: "apm2 binary refuses to start due to bootstrap verification failure"
      recovery_options:
        - option: "Use previous binary version"
          risk: "May not be compatible with ledger state"
        - option: "Bootstrap-safe-mode for diagnostics"
          command: "apm2 --bootstrap-safe-mode"
          capabilities: ["Read-only ledger inspection", "Compatibility report"]
        - option: "Emergency override with triple-signoff"
          requires: "AUTH_SECURITY + AUTH_OPS + AUTH_ENGINEERING"
          ceremony: "15-minute window, shared nonce"

    ledger_corruption:
      symptom: "DCP index inconsistent with ledger events"
      recovery_options:
        - option: "Rebuild DCP index from ledger"
          command: "apm2 dcp rebuild --from-checkpoint <hash>"
        - option: "Rollback to known-good checkpoint"
          requires: "Checkpoint hash from recent backup"

    pack_incompleteness_crisis:
      symptom: ">50% of runs failing due to pack misses"
      response_plan:
        - "Enable blanket escalation mode (bounded 72h)"
        - "Emergency pack spec review"
        - "Root cause analysis of defect patterns"
        - "Prioritized pack improvement sprint"
