rfc_ticket_decomposition:
  decomposition_strategy: "Independent bug fixes - all tickets can run in parallel"

  phases:
    - phase: 0
      name: "Bug Fixes (Parallel)"
      description: "All bug fixes are independent and can be implemented simultaneously"
      tickets:
        - ticket_id: "TCK-00055"
          title: "Fix CI failure detection in xtask check"
          requirements:
            - "MAINT-001"
          dependencies: []
          scope_summary: |
            Fix xtask/src/tasks/check.rs to properly detect CI failures:
            1. Add CheckRun struct with serde derives for JSON parsing
            2. Replace string matching with serde_json deserialization
            3. Handle the conclusion field: SUCCESS, FAILURE, CANCELLED, etc.
            4. Return appropriate CiStatus based on parsed data
            5. Add unit tests for JSON parsing edge cases

            Acceptance Criteria:
            - `cargo xtask check` correctly identifies failed CI checks
            - Displays failure reason and failed check name
            - Exit code reflects CI status (0 for pass, non-zero for fail)

        - ticket_id: "TCK-00056"
          title: "Fix AI review status creation in xtask push"
          requirements:
            - "MAINT-002"
          dependencies: []
          scope_summary: |
            Fix xtask/src/tasks/push.rs to correctly create GitHub commit statuses:
            1. Use separate variables for multi-word -f values in gh api calls
            2. Check actual command output/status, not just .is_ok()
            3. Report errors to user when status creation fails
            4. Add unit tests for argument escaping

            Acceptance Criteria:
            - `cargo xtask push` creates ai-review/security and ai-review/code-quality statuses
            - Statuses visible via GitHub API after push
            - Errors reported when status creation fails

        - ticket_id: "TCK-00057"
          title: "Fix Codex CLI invocation in xtask review"
          requirements:
            - "MAINT-003"
          dependencies: []
          scope_summary: |
            Fix xtask/src/tasks/review.rs to use correct Codex CLI syntax:
            1. Replace `codex -m o3 --approval-mode full-auto <prompt>` with
               `codex review --base main`
            2. Update push.rs to use consistent Codex invocation
            3. Add better error handling for Codex execution

            Acceptance Criteria:
            - `cargo xtask review quality <PR_URL>` runs without argument errors
            - Codex review executes successfully
            - Posts review comment or updates status

        - ticket_id: "TCK-00058"
          title: "Add pre-commit checks to xtask commit"
          type: ENHANCEMENT  # Note: This is a preventive enhancement, not a bug fix
          requirements:
            - "MAINT-004"
          dependencies: []
          scope_summary: |
            Enhance xtask/src/tasks/commit.rs to run local checks before commit:
            1. Run `cargo fmt --check` and fail if formatting issues found
            2. Run `cargo clippy --all-targets -- -D warnings` for lint checks
            3. Run `cargo semver-checks` if available (warn if not installed)
            4. Add --skip-checks flag to bypass checks when needed
            5. Display clear error messages indicating which check failed

            Acceptance Criteria:
            - `cargo xtask commit` runs fmt, clippy, semver-checks before commit
            - Commit fails if any check fails (unless --skip-checks)
            - Clear output showing which check failed and how to fix

            NOTE: This ticket is a preventive enhancement to catch issues before
            push. It is included in this RFC as it directly addresses the root
            cause of workflow failures (issues caught late in CI rather than early).
            Consider moving to separate enhancement RFC if scope clarity is needed.

  dependency_graph: |
    All tickets are independent (Level 0):

    ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
    │  TCK-00055  │  │  TCK-00056  │  │  TCK-00057  │  │  TCK-00058  │
    │ check.rs    │  │ push.rs     │  │ review.rs   │  │ commit.rs   │
    │ CI detect   │  │ status API  │  │ codex CLI   │  │ pre-checks  │
    └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘

    Parallelism: All 4 tickets can execute simultaneously

  notes: |
    All tickets modify existing xtask command files. No new modules or
    dependencies required. Each fix is isolated to a single file and can
    be tested independently.

    Verification after all fixes:
    ```bash
    cargo xtask start-ticket TCK-XXXXX
    # ... implement ...
    cargo xtask commit "feat: implement feature"  # Runs local checks
    cargo xtask push  # Creates PR, triggers AI reviews
    cargo xtask check  # Correctly reports CI/review status
    # PR auto-merges when all checks pass
    cargo xtask finish
    ```

    The commit command enhancement (TCK-00058) is preventive - it catches
    issues locally before they reach CI, reducing iteration time and CI load.
