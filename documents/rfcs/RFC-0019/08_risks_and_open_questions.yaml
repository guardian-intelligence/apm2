rfc_risks_and_open_questions:
  schema_version: "2026-01-23"
  template_version: "2026-01-23"
  risks:
    - id: "RSK-0001"
      statement: "Legacy allow path bypass: absent broker = client-side tool execution without kernel evidence"
      impact: "HIGH - Violates fail-closed constraint; enables unaudited tool execution"
      likelihood: "MEDIUM - Code path exists and is reachable"
      mitigations:
        - "Remove/gate legacy allow path"
        - "Require broker in production mode"
        - "Integration test verifies denial when broker absent"
      evidence_ids: []
      source_ref: "crates/apm2-daemon/src/protocol/session_dispatch.rs:956-1059"

    - id: "RSK-0002"
      statement: "Workspace escape: patch apply could write outside root or follow symlinks"
      impact: "HIGH - Arbitrary file write from untrusted patch"
      likelihood: "LOW - Requires malicious patch construction"
      mitigations:
        - "Strict path validation before apply"
        - "Canonical root containment check"
        - "Symlink policy (block or resolve within root)"
        - "Fuzz testing of patch paths"
      evidence_ids: []
      source_ref: "crates/apm2-daemon/src/episode/workspace.rs:683-707"

    - id: "RSK-0003"
      statement: "Receipt integrity: tool logs not linked to receipts prevents audit"
      impact: "MEDIUM - Cannot verify tool execution from receipt alone"
      likelihood: "HIGH - Current state doesn't propagate hashes"
      mitigations:
        - "Propagate CAS result_hash from executor (REQ-0004)"
        - "Emit ToolExecutionReceipt per tool actuation and store in CAS (REQ-0010)"
        - "ToolLogIndexV1 indexes ToolExecutionReceipt hashes (single pointer)"
        - "Review artifacts reference tool_log_index_hash (not an unstructured list)"
      evidence_ids: []
      source_ref: "crates/apm2-daemon/src/episode/executor.rs:458-501"

    - id: "RSK-0004"
      statement: "Projection duplication: restart causes repeated comments/statuses"
      impact: "MEDIUM - User confusion; polluted PR history"
      likelihood: "MEDIUM - Restarts are common during development"
      mitigations:
        - "Durable projection receipts"
        - "Idempotency keys based on (work_id, receipt_hash)"
        - "Check before write pattern"
      evidence_ids: []
      source_ref: "crates/apm2-daemon/src/projection/mod.rs:3-12"

    - id: "RSK-0005"
      statement: "TOCTOU race in symlink validation: attacker could swap symlink target between canonicalize and file operation"
      impact: "MEDIUM - Potential workspace escape via race condition"
      likelihood: "LOW - Requires local filesystem access during narrow time window; attacker must control symlink creation"
      mitigations:
        - "Use O_NOFOLLOW when opening files where applicable"
        - "Open file first, then verify via fstat that it's within root"
        - "Consider openat2() with RESOLVE_BENEATH on Linux"
      accepted_risk_rationale: |
        ACCEPTED for v0: Exploitation requires:
        1. Local filesystem access during tool execution window
        2. Ability to create symlinks in workspace
        3. Timing precision to win race

        Existing path validation catches most escape attempts. Defense-in-depth
        mitigations (O_NOFOLLOW, fstat) will be implemented in TCK-00319 as
        security hardening. This is a defense-in-depth concern, not a primary
        security boundary breach - the primary boundary is workspace isolation
        via root containment, which remains intact.
      evidence_ids: []
      source_ref: "crates/apm2-daemon/src/episode/handlers.rs:206-220"

    - id: "RSK-0006"
      statement: "Context poisoning / prompt injection via diffs and logs"
      impact: "HIGH - Can corrupt reviewer decisions or induce unsafe tool intents"
      likelihood: "MEDIUM - Diffs and tool outputs are untrusted and frequently adversarial"
      mitigations:
        - "Treat diffs/tool outputs as adversarial inputs"
        - "Enforce sealed ContextPack + broker-side context firewall; deny out-of-pack reads"
        - "Prefer structured tool APIs over shell access; record evidence hashes and require zoom-in by hash for gates"
      evidence_ids: []
      source_ref: "documents/rfcs/RFC-0019/03_trust_boundaries.yaml:TB-0006"

    - id: "RSK-0007"
      statement: "Exabyte evidence growth / DoS via unbounded logs and artifacts"
      impact: "MEDIUM - Storage blowup; degraded auditability and operability"
      likelihood: "MEDIUM - Long-running sessions and verbose tooling are common"
      mitigations:
        - "Hard artifact size ceilings in v0; store hashes/selectors in receipts"
        - "Chunkable/Merkle-friendly ToolLogIndex; bounded metadata"
        - "Evidence budgets enforced; compaction produces summary receipts with declared loss profile"
      evidence_ids: []
      source_ref: "documents/rfcs/RFC-0019/01_problem_and_imports.yaml:civilizational_scale_constraints"

    - id: "RSK-0008"
      statement: "Non-stationarity / drift (deps, tools, models) breaks replay/verification"
      impact: "HIGH - Receipts become non-replayable; verifier disagreement increases"
      likelihood: "HIGH - Toolchains and models drift continuously"
      mitigations:
        - "ViewCommitments pin toolchain/model/policy digests; no ambient HEAD/filesystem truth"
        - "Fail closed for high-risk tiers when pins unavailable; record drift as defects"
        - "Telemetry monitors verifier_disagreement_rate and receipt_completeness_rate"
      evidence_ids: []
      source_ref: "schemas/apm2/view_commitment.schema.json"

    - id: "RSK-0009"
      statement: "Adapter profile misconfiguration bypasses kernel-side tool execution"
      impact: "HIGH - Enables ambient authority and unaudited execution paths"
      likelihood: "MEDIUM - Heterogeneous CLIs have brittle integration surfaces"
      mitigations:
        - "AgentAdapterProfileV1 is hash-addressed and audited; ambient defaults forbidden"
        - "Conformance tests for each profile; fail closed on parse/misconfiguration errors"
        - "Kernel enforces tool mediation; adapter cannot execute tools directly"
      evidence_ids: []
      source_ref: "documents/rfcs/RFC-0019/03_trust_boundaries.yaml:TB-0008"

  open_questions:
    - id: "Q-0001"
      question: "Should ToolLogIndexV1 index ToolExecutionReceipt hashes only, or also duplicate ToolResultData hashes?"
      decision_needed_by: "TCK-00327 implementation"
      resolution_plan: "Default to indexing ToolExecutionReceipt hashes only; ToolExecutionReceipt already binds result_hash"
      v2_resolution:
        status: "RESOLVED"
        decision: "Index ToolExecutionReceipt hashes only; receipts bind args_hash/result_hash + policy/time envelope under the episode envelope"
        evidence_ref: "evidence/rfc/RFC-0019/reviews/rfc_explore_v2_grounding_20260204.yaml#Q-0001"

    - id: "Q-0002"
      question: "Should workspace cleanup be eager (on episode complete) or lazy (periodic GC)?"
      decision_needed_by: "TCK-00318 implementation"
      resolution_plan: "Start with eager cleanup; add lazy GC if performance requires"
      v2_resolution:
        status: "RESOLVED"
        decision: "Eager cleanup on episode completion; WorkspaceManager::restore() stub to be implemented"
        evidence_ref: "evidence/rfc/RFC-0019/reviews/rfc_explore_v2_grounding_20260204.yaml#Q-0002"

    - id: "Q-0003"
      question: "Should ProjectionReceiptRecorded include GitHub response data or only our intent?"
      decision_needed_by: "TCK-00323 implementation"
      resolution_plan: "Include minimal GitHub response (PR number, comment ID) for audit; avoid storing full response"
      v2_resolution:
        status: "RESOLVED"
        decision: "Include projection_receipt_hash, projected_status, and optional github_response_metadata (PR number, comment ID)"
        evidence_ref: "evidence/rfc/RFC-0019/reviews/rfc_explore_v2_grounding_20260204.yaml#Q-0003"

    - id: "Q-0004"
      question: "What is the retention policy for projection receipts?"
      decision_needed_by: "Post-v0 operational planning"
      resolution_plan: "Default to indefinite retention; add compaction policy in future RFC if needed"
      v2_resolution:
        status: "DEFERRED_POST_V0"
        decision: "Ledger events retained indefinitely; IdempotencyCache uses a bounded TTL+LRU policy (policy-defined)"
        evidence_ref: "evidence/rfc/RFC-0019/reviews/rfc_explore_v2_grounding_20260204.yaml#Q-0004"
