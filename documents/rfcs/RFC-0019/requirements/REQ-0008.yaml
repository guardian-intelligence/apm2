requirement:
  schema_version: "2026-01-23"
  id: "REQ-0008"
  title: "Holon-ready receipts: ViewCommitment + ContextPack binding"
  category: "FUNCTIONAL"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    Review outcomes MUST bind to a verifiable, self-contained world view and delegated authority:
    - Produce and store a ViewCommitment (CAS artifact; apm2.view_commitment.v1) and reference it by hash.
    - Seal ContextPacks as CAS artifacts and reference them by hash; initialize the broker context firewall from context_pack_hash (fail closed if missing/unsealable).
    - Ensure review artifacts/receipts bind at minimum:
      * view_commitment_hash
      * capability_manifest_hash
      * context_pack_hash
      * policy_resolved_ref (or equivalent stable binding to PolicyResolvedForChangeSet)
      * tool_log_index_hash (single-pointer audit index; tool_log_hashes list is deprecated for FAC v0+)

    Missing bindings MUST be a hard failure resulting in ReviewBlockedRecorded (not best-effort success).

    Versioning requirement:
    - If `ReviewArtifactBundleV1` cannot be extended safely, define `ReviewArtifactBundleV2` (or
      `ReviewArtifactBundleV1` + a required binding sub-artifact referenced by hash). The binding
      fields above MUST be present in the durable artifact layer, not only in in-memory structs.
  rationale: |
    Current ReviewArtifactBundleV1 binds review_text_hash, tool_log_hashes, and time_envelope_ref only.
    This is insufficient for replay/verification across holons/cells because it does not bind the receipt
    to (a) the pinned world (ViewCommitment) nor (b) delegated authority and bounded read surface
    (capability_manifest_hash, context_pack_hash). The RFC draft requires holon-ready receipts.
  acceptance_criteria:
    - "Review artifacts include view_commitment_hash, capability_manifest_hash, context_pack_hash, and policy_resolved_ref (or equivalent)"
    - "Context firewall is initialized from sealed ContextPack; missing/invalid ContextPack fails closed"
    - "Verifier can replay/verify from CAS+ledger without trusting local disk state or process memory"
    - "Missing bindings yield ReviewBlockedRecorded (not a successful ReviewReceiptRecorded)"
  evidence_ids:
    - "EVID-0008"
  source_refs:
    - "schemas/apm2/view_commitment.schema.json"
    - "schemas/apm2/review_artifact_bundle_v1.yaml"
    - "crates/apm2-core/src/fac/review_receipt.rs:298-316"
    - "proto/kernel_events.proto"
