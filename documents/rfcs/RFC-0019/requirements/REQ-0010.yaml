requirement:
  schema_version: "2026-01-23"
  id: "REQ-0010"
  title: "Proof-carrying tool execution and verifiable summaries"
  category: "FUNCTIONAL"
  priority: "P1"
  status: "PROPOSED"
  statement: |
    Tool actuation evidence MUST be replayable, scalable, and holon-ready (proof-carrying).

    Normative requirements (draft fidelity):

    1. Per-call CAS artifacts (data plane):
       - `ToolResultData` MUST be stored in CAS for every tool execution.
       - The execution stack MUST surface the CAS `result_hash` (REQ-0004 dependency).

    2. Per-call proof (authority plane):
       For every tool execution, the kernel MUST also generate a signed
       `ToolExecutionReceipt` and store it in CAS. The receipt MUST bind at minimum:
       - episode_envelope_hash (or equivalent episode digest)
       - policy_hash
       - request_id, capability_id
       - args_hash, result_hash
       - time_envelope_ref + duration
       - signer_identity + signature_over_canonical_bytes

       The ToolExecutionReceipt hash is the canonical "tool log entry" reference.

    3. Per-episode index (single-pointer scaling):
       Define and store a `ToolLogIndexV1` CAS artifact per episode that:
       - is canonically ordered (sorted by tool sequence number; deterministic tie-break)
       - lists ToolExecutionReceipt hashes (NOT raw transcripts, NOT only ToolResultData hashes)
       - is chunkable / Merkle-friendly so the interface remains stable as evidence grows
       - includes bounded metadata (episode_id, counts, budget consumption)

    4. Inter-holon front page:
       Generate a `SummaryReceipt` for review outcomes with:
       - verdict + top findings
       - declared loss profile
       - selectors to zoom into evidence by hash

    5. Receipt/artifact bindings:
       Review artifacts MUST reference:
       - tool_log_index_hash (single pointer)
       - summary_receipt_hash
       and MUST be verifiable from ledger+CAS without ambient filesystem truth.
  rationale: |
    Raw transcripts/logs are not a scalable inter-holon interface. Proof-carrying receipts and summary receipts
    allow supervising holons (and other cells) to verify outcomes using only CAS+ledger, fetching evidence by hash.
    The codebase already contains receipt infrastructure (AD-RECEIPT-001), but FAC runtime must integrate it.
  acceptance_criteria:
    - "Each tool actuation stores ToolResultData in CAS and surfaces result_hash (REQ-0004)"
    - "Each tool actuation emits a signed ToolExecutionReceipt stored in CAS"
    - "ToolLogIndexV1 stored in CAS references only resolvable ToolExecutionReceipt hashes"
    - "Review artifacts reference tool_log_index_hash and summary_receipt_hash"
    - "Offline audit can verify ToolExecutionReceipt -> args_hash/result_hash -> CAS artifacts without reading daemon filesystem state"
  evidence_ids:
    - "EVID-0010"
  source_refs:
    - "crates/apm2-daemon/src/evidence/receipt.rs"
    - "crates/apm2-daemon/src/evidence/receipt_builder.rs"
    - "schemas/apm2/summary_receipt.schema.json"
