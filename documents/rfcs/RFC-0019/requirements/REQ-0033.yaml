requirement:
  schema_version: "2026-02-09"
  id: "REQ-0033"
  title: "Network-independent gate execution with daemon-managed dependency hydration"
  category: "SECURITY"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    The EXECUTE phase (per REQ-0032) MUST run with all outbound network access
    denied. No gate process may initiate network connections during execution.

    The PREP phase MAY use network access exclusively to hydrate missing
    dependency closure entries (per REQ-0034). Network use in PREP is
    confined to closure hydration; no other PREP steps may initiate
    outbound connections.

    If the dependency closure is incomplete AND network access is unavailable
    during PREP, the system MUST fail early in PREP with exactly one normalized
    failure code: `PREP_SUPPLY_UNAVAILABLE`. The failure output MUST include:
      - `failure_code: "PREP_SUPPLY_UNAVAILABLE"`
      - `failure_class: "supply"`
      - `stage: "prep"`
      - `root_cause`: human-readable summary of what is missing
      - `remediation`: actionable instruction (e.g. "run on a network-connected
        host to hydrate the dependency closure, then retry")

    Raw cargo resolver errors, registry connection errors, or index fetch errors
    MUST NOT be surfaced as primary operator-facing failures. They are nested
    diagnostics within the structured failure.

    This requirement MUST NOT introduce additional user-visible failure modes
    beyond the normalized taxonomy (REQ-0035). The normalized code replaces,
    not supplements, the raw error surface.

    Primary delivery ticket: TCK-00622.
  rationale: |
    Network access during gate execution is a containment boundary violation:
    it allows gates to observe or influence external state, creating
    non-determinism and enabling side-channel leakage. Denying network during
    EXECUTE enforces the hermetic execution model. Daemon-owned hydration
    in PREP keeps the single-command operator UX intact: the operator does not
    need to pre-fetch dependencies manually, and the failure surface collapses
    to one normalized code when hydration is impossible.
  acceptance_criteria:
    - "EXECUTE phase: all gate processes run with network denied (verified by audit log or cgroup network namespace)."
    - "PREP phase: network access is confined to dependency closure hydration only."
    - "Offline run with pre-seeded closure: succeeds without network."
    - "Offline run without closure: emits exactly PREP_SUPPLY_UNAVAILABLE, not a raw cargo/registry error."
    - "No new user-visible failure modes introduced beyond the taxonomy in REQ-0035."
  evidence_ids:
    - "EVID-0033"
  source_refs:
    - "documents/rfcs/RFC-0019/20_fac_execution_substrate_build_farm_revision.md"
