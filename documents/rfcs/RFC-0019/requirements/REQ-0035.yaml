requirement:
  schema_version: "2026-02-09"
  id: "REQ-0035"
  title: "Bounded failure taxonomy with deterministic machine-readable remediation"
  category: "FUNCTIONAL"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    All `apm2 fac gates` failures MUST map to one of the following top-level
    failure classes (the taxonomy is closed; no new top-level classes may be
    added without a new requirement):

      PREP_NOT_READY          — Substrate not ready; autofix attempted and failed.
      PREP_SUPPLY_UNAVAILABLE — Dependency closure incomplete; network unavailable.
      AUTHORITY_DENIED        — Policy, token, or admission check rejected.
      GATE_EXECUTION_FAILED   — One or more gates failed during EXECUTE phase.

    Every failure event emitted on stdout MUST include the following fields:
      - `failure_code`:  one of the four codes above (string, machine-readable)
      - `failure_class`: coarser grouping (prep | authority | execution)
      - `stage`:         "prep" or "execute"
      - `root_cause`:    human-readable one-line summary
      - `remediation`:   actionable instruction the operator can follow

    Low-level errors (cargo resolver output, git fetch errors, syscall errors)
    MUST appear only as nested `diagnostics` within the structured failure
    event, never as standalone top-level output.

    Implementors MUST NOT need to read lane logs or internal service logs to
    diagnose any failure belonging to the four top-level classes.

    Primary delivery ticket: TCK-00624.
  rationale: |
    An unbounded failure surface — where each error source produces its own
    error message format — forces operators and implementor agents to maintain
    implicit knowledge of internal component errors. The closed taxonomy
    allows orchestrators, runbooks, and agents to make deterministic branching
    decisions on failure_code without reading internal logs. The remediation
    field closes the loop between detection and recovery action.
  acceptance_criteria:
    - "Every gates failure maps to exactly one of the four failure_code values."
    - "Every failure event on stdout includes failure_code, failure_class, stage, root_cause, and remediation."
    - "Low-level errors appear only in diagnostics[], not as top-level output."
    - "Given any PREP_NOT_READY or PREP_SUPPLY_UNAVAILABLE failure, the remediation field alone is sufficient for operator recovery without reading lane logs."
    - "CI tests enumerate all four failure codes and verify structured output shape."
  evidence_ids:
    - "EVID-0035"
  source_refs:
    - "documents/rfcs/RFC-0019/20_fac_execution_substrate_build_farm_revision.md"
