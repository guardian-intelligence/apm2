requirement:
  schema_version: "2026-02-09"
  id: "REQ-0031"
  title: "Zero-touch gates readiness controller: daemon-owned auto-bootstrap and self-heal"
  category: "FUNCTIONAL"
  priority: "P0"
  status: "PROPOSED"
  statement: |
    `apm2 fac gates` MUST invoke a daemon-owned readiness controller before any
    gate enqueue or execution begins. The readiness controller MUST execute a
    check → autofix → recheck loop covering all required substrate components:
      - FAC root directory tree and permissions
      - Lane pool existence and lane profile validity
      - Admitted canonicalizer tuple (policy root, toolchain, resolver)
      - Admitted economics profile
      - Worker and broker readiness
      - Managed cargo_home and local dependency substrate

    The readiness controller MUST be idempotent: running it on a fully ready
    substrate is a no-op with negligible overhead.

    Implementor workflows MUST NOT require manual bootstrap, adopt, or init
    commands as a prerequisite to running `apm2 fac gates`. A fresh worktree
    with a valid configuration file MUST succeed on the first `apm2 fac gates`
    invocation without any prior manual setup.

    If autofix fails for any component, the controller MUST emit a structured
    failure with a `PREP_NOT_READY` code and machine-readable remediation detail
    (per REQ-0035). It MUST NOT surface raw system errors as the primary failure.

    Primary delivery ticket: TCK-00620.
  rationale: |
    The current `apm2 fac gates` flow requires operators to run `fac bootstrap`,
    configure policy, and ensure lane readiness manually before gates work. This
    creates fragile ordering requirements, causes silent failures on fresh
    worktrees, and violates the principle that implementor agents should not need
    to reason about infrastructure state. Daemon-owned auto-bootstrap eliminates
    this class of failure entirely.
  acceptance_criteria:
    - "A fresh APM2_HOME (empty directory) with a valid config file: `apm2 fac gates` succeeds without any prior manual commands."
    - "Readiness controller runs check → autofix → recheck for all listed substrate components before any gate executes."
    - "Readiness controller is idempotent: no observable side effects on a fully-ready substrate."
    - "Readiness failure emits PREP_NOT_READY with machine-readable remediation, not a raw system error."
    - "Implementor dispatch prompt does not need to include any bootstrap/adopt/init instructions."
  evidence_ids:
    - "EVID-0031"
  source_refs:
    - "documents/rfcs/RFC-0019/20_fac_execution_substrate_build_farm_revision.md"
