rfc_rollout_and_ops:
  schema_version: "2026-01-25"
  template_version: "2026-01-25"

  rollout_plan:
    strategy: "Direct merge to main with developer adoption over time"
    rationale: |
      These are non-breaking configuration and documentation changes.
      The mold linker configuration takes effect immediately for all
      developers. sccache and nextest adoption is optional and documented.

    phases:
      - phase: 1
        name: "Configuration and Documentation"
        description: |
          Add mold linker configuration and update CONTRIBUTING.md with
          build optimization documentation.
        duration: "Single PR"
        success_criteria:
          - ".cargo/config.toml updated with mold configuration"
          - "CONTRIBUTING.md updated with optimization guide"
          - "All developers automatically use mold on next build"

      - phase: 2
        name: "Developer Adoption"
        description: |
          Developers gradually adopt sccache and nextest as they read
          the updated documentation or encounter build performance issues.
        duration: "Ongoing"
        success_criteria:
          - "Developers report faster builds"
          - "No build issues from mold configuration"

  operational_considerations:
    monitoring:
      - "Developers can compare build times before/after"
      - "sccache --show-stats shows cache hit rates"
      - "cargo build --timings shows detailed timing breakdown"

    rollback:
      strategy: "Comment out .cargo/config.toml entries"
      notes: |
        If mold causes issues on a particular system:
        1. Comment out [target.x86_64-unknown-linux-gnu] section
        2. Cargo falls back to default linker

    dependencies:
      - name: "mold"
        version: "2.x"
        installation:
          ubuntu: "apt install mold"
          fedora: "dnf install mold"
          arch: "pacman -S mold"
          macos: "brew install mold"
        notes: "Already installed on primary development system"

      - name: "clang"
        version: "any recent"
        installation:
          ubuntu: "apt install clang"
          fedora: "dnf install clang"
          arch: "pacman -S clang"
          macos: "Included with Xcode Command Line Tools"
        notes: "Required as linker driver for mold"

      - name: "sccache"
        version: "0.8.x"
        installation: "cargo install sccache"
        notes: "Optional; recommended for multi-worktree development"

      - name: "cargo-nextest"
        version: "0.9.x"
        installation: "cargo install cargo-nextest"
        notes: "Optional; recommended for faster test execution"

  troubleshooting:
    - issue: "Build fails: mold not found"
      cause: "mold not installed"
      solution: |
        Install mold via system package manager:
        - Ubuntu: apt install mold
        - Or comment out mold config in .cargo/config.toml

    - issue: "Build fails: clang not found"
      cause: "clang not installed"
      solution: |
        Install clang:
        - Ubuntu: apt install clang
        - Or modify config to use gcc with -fuse-ld=mold

    - issue: "sccache not working"
      cause: "RUSTC_WRAPPER not set"
      solution: |
        Add to shell profile:
        export RUSTC_WRAPPER=sccache

    - issue: "Tests slower than expected"
      cause: "Using cargo test instead of nextest"
      solution: |
        Install and use cargo-nextest:
        cargo install cargo-nextest
        cargo nextest run

    - issue: "mold config ignored on ARM64 Linux"
      cause: "Config only targets x86_64-unknown-linux-gnu"
      solution: |
        For ARM64 Linux (aarch64-unknown-linux-gnu), add a separate
        target section to .cargo/config.toml:
        [target.aarch64-unknown-linux-gnu]
        linker = "clang"
        rustflags = ["-C", "link-arg=-fuse-ld=mold"]

    - issue: "Error: linker 'clang' not found"
      cause: "clang not in PATH or not installed"
      solution: |
        Install clang or use gcc as alternative:
        - Ubuntu: apt install clang
        - Or change linker = "clang" to linker = "gcc" in config.toml
        Note: gcc works but clang provides slightly better diagnostics
