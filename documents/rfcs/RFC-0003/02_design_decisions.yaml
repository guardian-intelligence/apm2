rfc_design_decisions:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  decisions:
  - id: DEC-RFC-3001
    title: "Holon as Async Trait with Associated Types"
    statement: |
      Define the Holon contract as an async Rust trait with associated types for
      Input, Output, and State. Use async-trait for async method support.
    context: |
      The Holon trait forms the Markov blanket for agent participation. It must
      support diverse agent implementations while maintaining a consistent contract
      surface. The trait needs to be object-safe where possible and support async
      operations for I/O-bound agent work.
    alternatives:
    - id: ALT-0001
      name: "Concrete struct with generics"
      pros:
      - "No dynamic dispatch overhead"
      - "Full type inference"
      cons:
      - "Cannot store heterogeneous holons in collections"
      - "Less flexible for plugin-style extensibility"
      - "Harder to mock in tests"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Compile times increase with deep generic nesting"
    - id: ALT-0002
      name: "Trait objects with Box<dyn Holon>"
      pros:
      - "Heterogeneous collections possible"
      - "Plugin-style extensibility"
      cons:
      - "Dynamic dispatch overhead"
      - "Loss of associated type information at trait object boundary"
      - "Object safety constraints limit trait design"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Debug output less informative with erased types"
    - id: ALT-0003
      name: "Async trait with associated types (chosen)"
      pros:
      - "Clear contract surface with typed channels"
      - "Flexible for both generic and trait-object usage"
      - "Associated types preserve semantic meaning"
      - "Async support for I/O-bound operations"
      cons:
      - "Requires async-trait crate (until async fn in traits stabilizes)"
      - "Some object-safety limitations with associated types"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Stack traces through async-trait may be harder to read"
    chosen_rationale: |
      The async trait approach provides the best balance of type safety, flexibility,
      and expressiveness. Associated types (Input, Output, State) make the contract
      self-documenting and enable compile-time verification of holon wiring. The
      async-trait crate is mature and widely used; the minor overhead is acceptable
      for the flexibility gained.
    impacted_requirement_ids:
    - REQ-3001
    evidence_ids:
    - EVID-3001

  - id: DEC-RFC-3002
    title: "WorkObject State Machine Design"
    statement: |
      Model WorkObject lifecycle as an explicit state machine with states: Created,
      Leased, InProgress, Blocked, Completed, Escalated, Cancelled. Transitions are
      recorded as ledger events.
    context: |
      Work contracts need durable tracking from creation through completion. The state
      machine must support the full lifecycle including escalation paths and blocking
      conditions. All transitions must be auditable.
    alternatives:
    - id: ALT-0001
      name: "Simple status enum without state machine"
      pros:
      - "Simple to implement"
      - "Less code complexity"
      cons:
      - "No enforcement of valid transitions"
      - "Easy to create invalid state sequences"
      - "Harder to reason about lifecycle"
      security_tradeoffs:
      - "Invalid state transitions could allow work to be marked complete prematurely"
      operability_tradeoffs:
      - "Debugging invalid states requires log analysis"
    - id: ALT-0002
      name: "State machine with transition methods (chosen)"
      pros:
      - "Valid transitions enforced at compile time"
      - "Clear lifecycle documentation in code"
      - "Transitions produce events for audit trail"
      - "Pattern matching ensures exhaustive handling"
      cons:
      - "More code to maintain"
      - "State type must be included in signatures"
      security_tradeoffs: []
      operability_tradeoffs:
      - "State machine violations surface as type errors, easier to debug"
    - id: ALT-0003
      name: "External workflow engine"
      pros:
      - "Rich workflow features (timers, retries, etc.)"
      - "Visual workflow modeling"
      cons:
      - "External dependency"
      - "Serialization overhead"
      - "Overkill for initial requirements"
      security_tradeoffs:
      - "Additional attack surface from external system"
      operability_tradeoffs:
      - "Requires workflow engine deployment and monitoring"
    chosen_rationale: |
      An explicit state machine with transition methods provides the right balance
      of safety and simplicity. The typestate pattern in Rust (using enums with
      transition methods) enforces valid transitions at compile time. Each transition
      emits a ledger event, providing a complete audit trail. This approach is
      self-contained and avoids external dependencies while maintaining rigor.
    impacted_requirement_ids:
    - REQ-0014
    - REQ-3002
    evidence_ids:
    - EVID-3002

  - id: DEC-RFC-3003
    title: "Lease Derivation for Sub-Holons"
    statement: |
      Sub-holons receive derived leases that are strictly bounded by their parent's
      lease. Derived leases have reduced scope, lower budgets, and earlier expiration.
      Derivation is a pure function of the parent lease and delegation request.
    context: |
      Holonic coordination requires recursive delegation where parent holons spawn
      sub-holons to handle portions of work. Authority must flow downward with
      appropriate constraints to maintain Bounded Authority (Axiom III).
    alternatives:
    - id: ALT-0001
      name: "Pass-through parent lease"
      pros:
      - "Simplest implementation"
      - "No derivation logic needed"
      cons:
      - "Violates Bounded Authority axiom"
      - "Sub-holons have same authority as parent"
      - "No resource isolation between siblings"
      security_tradeoffs:
      - "Sub-holon could exhaust parent's entire budget"
      - "Compromised sub-holon has full parent authority"
      operability_tradeoffs:
      - "Cannot track resource usage per sub-holon"
    - id: ALT-0002
      name: "Derived leases with strict bounding (chosen)"
      pros:
      - "Enforces Bounded Authority axiom"
      - "Resource isolation between sub-holons"
      - "Parent controls delegation scope"
      - "Derivation is deterministic and auditable"
      cons:
      - "Derivation logic adds complexity"
      - "Must track remaining parent budget"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Budget exhaustion is isolated to sub-holon scope"
    - id: ALT-0003
      name: "Independent leases from registrar"
      pros:
      - "Clean separation of authority"
      - "Registrar has global view"
      cons:
      - "Breaks holonic hierarchy"
      - "Registrar becomes bottleneck"
      - "Parent cannot control sub-holon resources"
      security_tradeoffs:
      - "Authority flows outside holonic hierarchy"
      operability_tradeoffs:
      - "Registrar failure blocks all lease operations"
    chosen_rationale: |
      Derived leases maintain the holonic hierarchy while enforcing bounded authority.
      The derivation function ensures that: (1) derived scope is a subset of parent
      scope, (2) derived budget is deducted from parent budget, (3) derived expiration
      is at or before parent expiration. This creates resource isolation while
      preserving the recursive composability of holons.
    impacted_requirement_ids:
    - REQ-0021
    - REQ-0022
    - REQ-3003
    evidence_ids:
    - EVID-3004

  - id: DEC-RFC-3004
    title: "Episode Stop Condition Evaluation"
    statement: |
      Episodes evaluate stop conditions after each agent turn. Stop conditions include:
      budget exhaustion, explicit completion signal, error threshold, context limit,
      and time expiration. Evaluation is synchronous and deterministic.
    context: |
      Agent execution must be bounded to prevent runaway resource consumption and
      ensure predictable behavior. Stop conditions define when an episode should
      terminate, whether successfully or with escalation.
    alternatives:
    - id: ALT-0001
      name: "Fixed iteration limit only"
      pros:
      - "Simple to implement"
      - "Predictable termination"
      cons:
      - "Cannot adapt to completion signals"
      - "May terminate too early or too late"
      - "No budget awareness"
      security_tradeoffs:
      - "No protection against resource-intensive iterations"
      operability_tradeoffs:
      - "Hard to tune iteration limit across different work types"
    - id: ALT-0002
      name: "Composite stop conditions with priority (chosen)"
      pros:
      - "Multiple termination criteria"
      - "Budget enforcement prevents runaway costs"
      - "Completion signal enables early termination"
      - "Deterministic evaluation order"
      cons:
      - "More complex evaluation logic"
      - "Stop conditions must be carefully ordered"
      security_tradeoffs: []
      operability_tradeoffs:
      - "Clear stop reason aids debugging"
    - id: ALT-0003
      name: "External watchdog process"
      pros:
      - "Independent termination authority"
      - "Can handle hung episodes"
      cons:
      - "Race conditions between episode and watchdog"
      - "External process coordination overhead"
      - "Less deterministic behavior"
      security_tradeoffs:
      - "Watchdog must be protected from compromise"
      operability_tradeoffs:
      - "Requires watchdog monitoring and restart logic"
    chosen_rationale: |
      Composite stop conditions provide comprehensive control over episode termination
      while remaining deterministic. The evaluation order is: (1) budget exhausted,
      (2) explicit completion, (3) error threshold, (4) context limit, (5) time
      expiration. This ordering ensures that resource limits are checked first,
      followed by semantic completion, then error conditions. The synchronous
      evaluation after each turn provides predictable behavior and clear stop reasons.
    impacted_requirement_ids:
    - REQ-0019
    - REQ-0035
    - REQ-3004
    evidence_ids:
    - EVID-3002
