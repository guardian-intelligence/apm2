ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00223"
    title: "FAC: AAT selection policy engine"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0015"
    requirements:
      - requirement_id: "FAC-REQ-0009"
        requirement_ref: "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
    evidence_artifacts:
      - evidence_id: "EVID-FAC-0009"
        artifact_ref: "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_CORE"
  dependencies:
    tickets:
      - "TCK-00222"
  scope:
    in_scope:
      - "Define SelectionPolicy struct"
      - "Define TierConfig for each risk tier"
      - "Implement should_run_aat() logic"
      - "Implement deterministic sampling for LOW tier"
    out_of_scope:
      - "Policy configuration UI"
      - "Policy versioning"
  plan:
    steps:
      - "Create crates/apm2-core/src/fac/selection_policy.rs"
      - "Define SelectionPolicy struct with tier configs"
      - "Define TierConfig with aat_required and sample_rate"
      - "Define AatRequirement enum (Always, Conditional, Sampled)"
      - "Implement should_run_aat(risk_tier, context)"
      - "Implement sample() with deterministic hash-based sampling"
      - "Write unit tests for HIGH tier (always)"
      - "Write unit tests for MED tier (conditional)"
      - "Write unit tests for LOW tier (sampled)"
  definition_of_done:
    evidence_ids:
      - "EVID-FAC-0009"
    criteria:
      - "HIGH tier always requires AAT"
      - "MED tier requires AAT for sensitive domains"
      - "LOW tier uses deterministic sampling"
      - "cargo test -p apm2-core fac::selection_policy::tests passes"
  notes:
    security: |
      The selection policy ensures appropriate AAT coverage
      based on risk. HIGH risk changes are always tested.
      LOW risk uses sampling to manage cost.
    implementation_details: |
      SelectionPolicy fields:
      - policy_id, policy_hash
      - high_tier_config: TierConfig
      - med_tier_config: TierConfig
      - low_tier_config: TierConfig

      should_run_aat logic:
      - HIGH: always true
      - MED: true if sensitive domain
      - LOW: sample(work_id) with sample_rate
    affected_files: |
      Created: crates/apm2-core/src/fac/selection_policy.rs
