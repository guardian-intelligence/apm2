ticket_meta:
  schema_version: '2026-01-26'
  template_version: '2026-01-26'
  ticket:
    id: TCK-00266
    title: Implement session registry with persistent state file
    status: "CLOSED"
  binds:
    rfc_id: RFC-0017
    requirements:
    - requirement_id: REQ-DCP-0013
acceptance_criteria:
- criterion: State file contains active sessions
  verification: cat state_file shows session entries
- criterion: State survives daemon restart
  verification: Restart preserves session knowledge
implementation:
  code_examples: []
  files_to_create: []
  files_to_modify:
  - changes: 'Add persistent state file for crash recovery.

      Atomic writes (write-to-temp + rename).

      '
    path: crates/apm2-daemon/src/episode/registry.rs
  - changes: 'Wire state_file config option.

      '
    path: ecosystem.example.toml
  implementation_steps: []
  summary: ''
notes: 'Phase: PHASE-3

  Generated from RFC RFC-0017 ticket decomposition on 2026-01-30.'
test_requirements:
- description: Unit tests pass
  test_id: UT-00266-01
  verification_command: cargo test -p apm2-core tck_00266
- description: Integration test
  test_id: IT-00266-01
  verification_command: cargo run --bin apm2 -- factory tickets emit --rfc RFC-0017
