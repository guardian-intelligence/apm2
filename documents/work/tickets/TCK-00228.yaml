ticket_meta:
  schema_version: "2026-01-29"
  template_version: "2026-01-29"
  ticket:
    id: "TCK-00228"
    title: "FAC: AAT reuse provenance validation"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0015"
    requirements:
      - requirement_id: "FAC-REQ-0013"
        requirement_ref: "documents/rfcs/RFC-0015/01_problem_and_imports.yaml#rfc_imported_requirements"
    evidence_artifacts:
      - evidence_id: "EVID-FAC-0015"
        artifact_ref: "documents/rfcs/RFC-0015/07_test_and_evidence.yaml#evidence_requirements"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_CORE"
  dependencies:
    tickets:
      - "TCK-00218"
      - "TCK-00222"
  scope:
    in_scope:
      - "Add AATResultReused proto message"
      - "Define AatProvenanceTuple struct"
      - "Implement can_reuse_aat_result() validation"
      - "Enforce tier-based reuse restrictions"
    out_of_scope:
      - "AAT result caching"
      - "Reuse decision logic"
  plan:
    steps:
      - "Add AATResultReused message to proto/kernel_events.proto"
      - "Create crates/apm2-core/src/fac/aat_reuse.rs"
      - "Define AATResultReused struct"
      - "Define AatProvenanceTuple struct"
      - "Implement can_reuse_aat_result(risk_tier, original, current)"
      - "HIGH tier: always return Err(HighTierNoReuse)"
      - "MED tier: return Err(MedTierRequiresWaiver)"
      - "LOW tier: exact provenance match required"
      - "Write unit tests for tier-based reuse"
  definition_of_done:
    evidence_ids:
      - "EVID-FAC-0015"
    criteria:
      - "HIGH tier never reuses AAT results"
      - "MED tier requires waiver for reuse"
      - "LOW tier requires exact provenance match"
      - "cargo test -p apm2-core fac::aat_reuse::tests passes"
  notes:
    security: |
      AAT reuse must be carefully controlled to prevent using
      stale evidence. HIGH risk changes never reuse results.
    implementation_details: |
      AATResultReused fields:
      - from_receipt_hash, provenance, policy_hash
      - justification, gate_signature

      AatProvenanceTuple fields:
      - changeset_digest, view_commitment_hash
      - rcp_profile_id, verifier_policy_hash
      - determinism_class

      Reuse rules:
      - HIGH: never
      - MED: requires waiver
      - LOW: exact provenance match
    affected_files: |
      Modified: proto/kernel_events.proto
      Created: crates/apm2-core/src/fac/aat_reuse.rs
