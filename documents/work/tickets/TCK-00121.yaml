schema_version: "2026-01-26"
template_version: "2026-01-26"

ticket:
  id: TCK-00121
  title: "Update idea-compiler and rfc-council skills"
  status: READY
  rfc_id: RFC-0010
  requirement_ids:
    - REQ-0010
  depends_on:
    - TCK-00120

implementation:
  summary: |
    Update the idea-compiler and rfc-council skill files to integrate with the
    new apm2 factory compile pipeline. The idea-compiler skill needs complete
    CLI invocation guides, and rfc-council needs to enforce CCP and Impact Map
    prerequisites before RFC review.

  files_to_create: []

  files_to_modify:
    - path: ".claude/skills/idea-compiler/SKILL.md"
      changes: "Add complete CLI invocation guide for apm2 factory compile with all flags and workflow examples"

    - path: ".claude/skills/rfc-council/SKILL.md"
      changes: "Add CCP and Impact Map validation requirements; fail fast if artifacts missing"

  implementation_steps:
    - step: 1
      action: "Update idea-compiler skill with CLI guide"
      details: |
        In SKILL.md:
        - Add section "CLI Integration" with full command reference
        - Document apm2 factory compile --prd <PRD-ID> workflow
        - Include --dry-run usage for validation before execution
        - Document --profile flag for routing configuration
        - Add troubleshooting section for common errors

    - step: 2
      action: "Add idea-compiler workflow examples"
      details: |
        In SKILL.md:
        - Example: Full compilation from PRD to tickets
        - Example: Dry-run validation workflow
        - Example: Using custom routing profiles
        - Example: Interpreting NDJSON output

    - step: 3
      action: "Update rfc-council with prerequisites"
      details: |
        In SKILL.md:
        - Add "Prerequisites" section
        - Require CCP index exists at evidence/prd/<PRD-ID>/ccp/ccp_index.json
        - Require Impact Map exists at evidence/prd/<PRD-ID>/impact_map/
        - Document how to generate missing artifacts using apm2 CLI

    - step: 4
      action: "Add rfc-council validation logic"
      details: |
        In SKILL.md:
        - Add decision tree for prerequisite validation
        - If CCP missing: instruct to run apm2 factory ccp build
        - If Impact Map missing: instruct to run apm2 factory impact-map build
        - Only proceed with RFC review after artifacts validated

    - step: 5
      action: "Validate skill formatting"
      details: |
        Run cargo xtask lint to ensure:
        - Skill files pass lint rules
        - No broken references
        - Consistent formatting

  code_examples:
    - description: "idea-compiler CLI section"
      code: |
        ## CLI Integration

        The idea-compiler skill orchestrates the apm2 factory compile pipeline:

        ```bash
        # Full compilation from PRD to tickets
        apm2 factory compile --prd PRD-0005 --rfc RFC-0011

        # Dry-run to preview changes without writing files
        apm2 factory compile --prd PRD-0005 --dry-run

        # With production routing profile and signing
        apm2 factory compile --prd PRD-0005 --profile production --sign
        ```

    - description: "rfc-council prerequisites section"
      code: |
        ## Prerequisites

        Before RFC review can proceed, the following artifacts MUST exist:

        1. **CCP Index**: `evidence/prd/<PRD-ID>/ccp/ccp_index.json`
           - Generate with: `apm2 factory ccp build --prd <PRD-ID>`

        2. **Impact Map**: `evidence/prd/<PRD-ID>/impact_map/impact_map.yaml`
           - Generate with: `apm2 factory impact-map build --prd <PRD-ID>`

        If artifacts are missing, generate them before proceeding with RFC review.

acceptance_criteria:
  - criterion: "idea-compiler invokes apm2 factory compile correctly"
    verification: "Skill file contains accurate CLI commands that match implemented interface"

  - criterion: "rfc-council validates CCP/Impact Map exist"
    verification: "Skill file includes prerequisite checks and instructions for generating missing artifacts"

test_requirements:
  - test_id: LT-121-01
    description: "Lint validation of updated skill files"
    verification_command: "cargo xtask lint"

  - test_id: MT-121-02
    description: "Manual verification that skill CLI commands match implementation"
    verification_command: "apm2 factory compile --help"

notes: |
  This ticket implements REQ-0010 (skill integration) from RFC-0010.

  Key design decisions:
  - Skills provide agent-consumable documentation of CLI capabilities.
  - rfc-council enforces CCP grounding by requiring artifacts before review.
  - Failing fast on missing prerequisites prevents wasted review cycles.

  CCP grounding: COMP-SKILLS, integrates with compile pipeline from TCK-00120.

  The skill updates are documentation-focused but critical for agent workflows
  to correctly invoke the new pipeline capabilities.
