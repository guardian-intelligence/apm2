ticket_meta:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  ticket:
    id: "TCK-00317"
    title: "Reviewer capability manifest (real allowlist)"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0019"
    requirements:
      - requirement_id: "REQ-0002"
        requirement_ref: "documents/rfcs/RFC-0019/requirements/REQ-0002.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0002"
        artifact_ref: "documents/rfcs/RFC-0019/evidence_artifacts/EVID-0002.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_DAEMON"
      - "DOMAIN_SECURITY"
  dependencies:
    tickets:
      - ticket_id: "TCK-00292"
        reason: "Capability manifest core types/validation exist; this ticket supplies real reviewer v0 content"
      - ticket_id: "TCK-00293"
        reason: "CAS required to store manifests by content hash"
      - ticket_id: "TCK-00316"
        reason: "Session tool execution must be kernel-side for manifests to be meaningful"
  scope:
    in_scope:
      - "Define reviewer v0 capability manifest content (tool classes + risk tiers + CAS hash allowlist)"
      - "Store reviewer manifest bytes as a CAS artifact and reference it by hash"
      - "Ensure policy resolution returns the reviewer manifest hash (no empty allowlist stubs)"
      - "Ensure SpawnEpisode loads the manifest by hash and registers it for the session/broker"
      - "Add tests proving reviewer v0 tools are allowed and non-allowlisted tools are denied"
    out_of_scope:
      - "Implementor v0 manifest and higher-risk tool surfaces (future)"
      - "Dynamic capability updates during an episode"
  plan:
    steps:
      - "Define the reviewer v0 tool surface (Git read-only, ArtifactFetch, ListFiles, Search, optional ReadFile) and required risk tiers"
      - "Implement canonical manifest serialization for CAS storage and compute/verify hash"
      - "Update policy resolution (StubPolicyResolver + future GovernancePolicyResolver contract) to return the stored manifest hash"
      - "Update SpawnEpisode/ClaimWork flow to load the manifest from CAS by hash and register it for the session"
      - "Add unit tests for manifest allowlist enforcement and fail-closed behavior on missing manifests"
      - "Add integration test that a spawned reviewer session can request allowed tools and is denied for disallowed tool classes"
  definition_of_done:
    evidence_ids:
      - "EVID-0002"
    criteria:
      - "Reviewer v0 manifest is stored in CAS and referenced by hash."
      - "SpawnEpisode registers a non-empty reviewer v0 allowlist (no stubs)."
      - "Allowed tool classes succeed and non-allowlisted tools are denied deterministically."
  notes:
    security: "OCAP-only; default deny; manifests are hash-addressed and verified on load."
    verification: "Tests must include both allow and deny cases; missing manifest hash must fail closed."
    general: "This ticket removes the empty-allowlist blocker that prevents FAC v0 episodes from progressing."

