ticket_meta:
  schema_version: "2026-01-24"
  template_version: "2026-01-24"
  ticket:
    id: "TCK-00330"
    title: "Adapter conformance tests + ledger attribution"
  binds:
    prd_id: "PRD-0009"
    rfc_id: "RFC-0019"
    requirements:
      - requirement_id: "REQ-0009"
        requirement_ref: "documents/rfcs/RFC-0019/requirements/REQ-0009.yaml#requirement"
    evidence_artifacts:
      - evidence_id: "EVID-0009"
        artifact_ref: "documents/rfcs/RFC-0019/evidence_artifacts/EVID-0009.yaml#evidence_artifact"
  custody:
    agent_roles:
      - "AGENT_IMPLEMENTER"
    responsibility_domains:
      - "DOMAIN_DAEMON"
      - "DOMAIN_KERNEL"
  dependencies:
    tickets:
      - ticket_id: "TCK-00328"
        reason: "Adapter registry and profile selection by hash must exist for conformance tests"
      - ticket_id: "TCK-00329"
        reason: "Concrete profiles must exist to test"
  scope:
    in_scope:
      - "Add conformance tests for each AgentAdapterProfileV1"
      - "Emit ledger events attributing runs by (work_id, episode_id, session_id, adapter_profile_hash)"
      - "Demonstrate non-interactive receipt production across profiles under kernel tool mediation"
    out_of_scope:
      - "Full evaluation benchmark suite (post-v0)"
  plan:
    steps:
      - "Define a conformance harness that can run an adapter profile in non-interactive mode and assert receipt production"
      - "Add tests per profile (claude-code, gemini-cli, codex-cli, local-inference) with skip/feature gating as needed"
      - "Ensure ledger events include adapter_profile_hash attribution for every run"
      - "Add negative tests: misconfigured profile fails closed with ReviewBlockedRecorded(reason=ADAPTER_MISCONFIGURED)"
  definition_of_done:
    evidence_ids:
      - "EVID-0009"
    criteria:
      - "Conformance tests pass for all profiles."
      - "Ledger events include adapter_profile_hash attribution."
      - "No tool execution occurs outside kernel mediation in conformance runs."
  notes:
    security: "Conformance tests are security tests: they must detect any adapter bypass of kernel tool execution."
    verification: "Record adapter_profile_hash in every relevant event and verify reproducibility via CAS hashes."
    general: "Ensures the adapter profile system is real, reproducible, and auditable."

