{
  "schema": "apm2.prd.cac.v1",
  "schema_version": "1.1.0",
  "generated_at": "2026-01-29",
  "classification": {
    "default_data_classification": "INTERNAL",
    "security_critical": true,
    "risk_tier_default": "T3",
    "notes": [
      "FAC governs promotion to trunk; treat all control-plane decisions as adversarial surfaces.",
      "Fail-closed: uncertain truth implies deny admission or escalate to adjudication/oracle.",
      "GitHub is a projection target; it is never a source of truth."
    ]
  },
  "doc": {
    "id": "APM2-PRD-FAC-0001",
    "title": "Forge Admission Cycle (FAC) v1.1 \u2014 Hardened Protocol with Efficient ZTI and Phase-2 Drift Controls",
    "status": "draft",
    "priority": "P0",
    "time_horizon": "Phase 1 -> Phase 3 (then autonomous self-improvement expected)",
    "owners": [
      {
        "holon_id": "HOLON-KERNEL-GOVERNANCE",
        "role": "critical event signing, authority minting, key policy"
      },
      {
        "holon_id": "HOLON-KERNEL-GATE",
        "role": "gate receipt verification, admission decision, merge receipt"
      },
      {
        "holon_id": "HOLON-COORDINATOR",
        "role": "CAS-at-commit orchestration, bounded retries, echo-trap detection"
      },
      {
        "holon_id": "HOLON-CONTEXT-COMPILER",
        "role": "CCP/RCP compilation, impact expansion, ZTI scoring"
      },
      {
        "holon_id": "HOLON-GITHUB-ADAPTER",
        "role": "projection-only sync + divergence watchdog"
      },
      {
        "holon_id": "HOLON-AUDITOR",
        "role": "measurement integrity, drift/holdout auditing (Phase 2)"
      }
    ],
    "scope_tags": [
      "forge",
      "admission",
      "gates",
      "ledger",
      "cas",
      "ocap",
      "context_packs",
      "projection",
      "ci_attestation",
      "containment",
      "measurement_integrity",
      "goodhart",
      "efficiency"
    ]
  },
  "references": {
    "glossary": "documents/skills/glossary/SKILL.md",
    "laws": "documents/skills/laws-of-holonic-agent-systems/SKILL.md",
    "work_substrate": "documents/prds/PRD-0004/",
    "cac_substrate": "documents/prds/PRD-0007/",
    "coordination": "documents/rfcs/RFC-0012/",
    "daemon_runtime": "documents/rfcs/RFC-0013/",
    "git_digest": "documents/skills/glossary/references/git_digest_conventions.md"
  },
  "summary": {
    "one_line": "FAC is the internal, cryptographically enforced admission protocol; reviewers/verifiers sign lease-bound outcomes; merges are proven by MergeReceipts; GitHub is a projection.",
    "north_star": "APM2 CLI runs the PR inner loop as a hardened protocol: admission is impossible to spoof, and every decision is replayable from ledger+CAS under strict OCAP.",
    "why_now": [
      "Agents currently can spoof external statuses and bypass intended scrutiny.",
      "FAC closes the loop with internal authority minting, OCAP containment, and projection-only forges."
    ]
  },
  "terminology": [
    {
      "term": "Gate",
      "ref": "documents/skills/glossary/references/gate.md"
    },
    {
      "term": "Merge Receipt",
      "ref": "documents/skills/glossary/references/merge_receipt.md"
    },
    {
      "term": "ContextPack",
      "ref": "documents/skills/glossary/references/context_pack.md"
    },
    {
      "term": "View Commitment",
      "ref": "documents/skills/glossary/references/view_commitment.md"
    },
    {
      "term": "Lease/Budget",
      "ref": "documents/skills/glossary/references/lease_and_budget.md"
    },
    {
      "term": "OCAP",
      "ref": "documents/skills/glossary/references/ocap.md"
    },
    {
      "term": "Terminal Verifier",
      "ref": "documents/skills/glossary/references/terminal_verifier.md"
    },
    {
      "term": "Oracle",
      "ref": "documents/skills/glossary/references/oracle.md"
    }
  ],
  "law_alignment": [
    {
      "law_id": "LAW-01",
      "applies_to": [
        "GateRunCompleted",
        "MergeReceipt"
      ],
      "enforcement": "Signed events + receipt verification + deterministic admission projection"
    },
    {
      "law_id": "LAW-02",
      "applies_to": [
        "ContextPack",
        "RunReceipt"
      ],
      "enforcement": "Context sufficiency observed; context misses terminate and trigger refinement"
    },
    {
      "law_id": "LAW-03",
      "applies_to": [
        "GitHub adapter"
      ],
      "enforcement": "Ledger is truth; projections overwriteable; divergence detection halts factory"
    },
    {
      "law_id": "LAW-04",
      "applies_to": [
        "LLM reviewers"
      ],
      "enforcement": "Terminal verifiers anchor; advisory signals never sole admission basis"
    },
    {
      "law_id": "LAW-05",
      "applies_to": [
        "OCAP"
      ],
      "enforcement": "Mechanical context firewall + capability scoping; no ambient credentials"
    },
    {
      "law_id": "LAW-08",
      "applies_to": [
        "Gates"
      ],
      "enforcement": "Holdouts/adversarial suites + evaluator audit (Phase 2)"
    },
    {
      "law_id": "LAW-10",
      "applies_to": [
        "Merge semantics"
      ],
      "enforcement": "Atomic merge receipt binds (base, changeset) -> result; anti-entropy divergence checks"
    },
    {
      "law_id": "LAW-12",
      "applies_to": [
        "Coordinator"
      ],
      "enforcement": "Bounded retries, echo-trap detection, oracle escalation"
    },
    {
      "law_id": "LAW-15",
      "applies_to": [
        "Metrics"
      ],
      "enforcement": "Measurement integrity: auditor sampling + drift alarms"
    }
  ],
  "requirements": {
    "inherits": [
      "PRD-0004: REQ-0009 Signed GateRunCompleted",
      "PRD-0004: REQ-0015 GitHub sync adapter projects ledger state",
      "PRD-0004: REQ-0025 Critical Event Signing"
    ],
    "new": [
      {
        "id": "FAC-REQ-0100",
        "type": "SECURITY",
        "title": "Mechanical Context Firewall",
        "statement": "apm2-daemon MUST deny any read outside ContextPack allowlist for CONSUME-mode holons; context misses MUST terminate and trigger refinement.",
        "acceptance": [
          "Denied reads emit ToolDecided=DENY with rule_id CTX-ALLOWLIST-001.",
          "SessionTerminated rationale=CONTEXT_MISS occurs when required context absent; GateRunCompleted is not emitted."
        ]
      },
      {
        "id": "FAC-REQ-0101",
        "type": "SECURITY",
        "title": "Projection Divergence Emergency Stop",
        "statement": "If external trunk diverges from internal MergeReceipt truth, FAC MUST freeze admissions until reconciled.",
        "acceptance": [
          "Divergence watchdog emits PROJECTION_DIVERGENCE defect and InterventionFreeze(repo).",
          "Freeze blocks new admissions and merges for the repo until reconciliation.",
          "Unfreeze requires AdjudicationResolved(request_type=EMERGENCY_RECOVERY) or PRD-0007 emergency_override ceremony if the adapter cannot reconcile."
        ]
      },
      {
        "id": "FAC-REQ-0102",
        "type": "SECURITY",
        "title": "CI evidence-backed readiness gating",
        "statement": "If CI is used to transition work into READY_FOR_REVIEW, the transition MUST be backed by imported raw evidence digests and adapter attestation.",
        "acceptance": [
          "No transition based only on 'success' conclusion.",
          "EvidencePublished entries exist for CI logs/artifacts and are referenced from transition rationale metadata."
        ]
      }
    ]
  },
  "protocol": {
    "name": "Forge Admission Cycle (FAC)",
    "stages": [
      {
        "stage_id": "FAC-00-INGEST_CHANGESET",
        "name": "Ingest ChangeSet + View Commitment",
        "purpose": "Bind a candidate change to pinned inputs; produce a ChangeSetDigest and PRBundle artifact.",
        "inputs": [
          "work_id",
          "plan_snapshot_hash",
          "base_selector",
          "workspace_delta_or_commit_range"
        ],
        "outputs": [
          "changeset_digest",
          "pr_bundle_hash",
          "view_commitment_hash",
          "run_receipt_hash"
        ],
        "actors": [
          "HOLON-COORDINATOR"
        ],
        "invariants": [
          "All selectors are resolved to concrete git object IDs (commit/tree) (no symbolic HEAD).",
          "Workspace deltas are content-addressed artifacts; never inferred from disk.",
          "CAS-at-commit: bind changeset_digest to work_id in ledger before spawning any gate episodes."
        ],
        "defects_on_violation": [
          "INVALID_SELECTOR",
          "UNPINNED_INPUTS"
        ]
      },
      {
        "stage_id": "FAC-01-CI_EVIDENCE_IMPORT",
        "name": "Import CI evidence (projection->evidence), not CI truth",
        "purpose": "Capture CI outputs as evidence artifacts; optionally gate readiness-for-review.",
        "inputs": [
          "pr_number",
          "commit_sha",
          "ci_provider_observations",
          "workflow_artifacts"
        ],
        "outputs": [
          "ci_evidence_bundle_hash",
          "ci_import_attestation_hash",
          "work_transition_ready_for_review?"
        ],
        "actors": [
          "HOLON-GITHUB-ADAPTER"
        ],
        "invariants": [
          "CI observations are never treated as authoritative admission signals.",
          "If readiness transition is emitted, it must be backed by imported raw artifacts/log digests stored in CAS.",
          "READY_FOR_REVIEW transition requires: (a) webhook signature verified, (b) raw log/artifact digests imported into CAS, (c) adapter attestation signed and committed.",
          "A plain 'success' conclusion without evidence import is ignored (fail-closed)."
        ],
        "defects_on_violation": [
          "CI_EVIDENCE_MISSING",
          "CI_SHA_MISMATCH",
          "CI_ATTESTATION_INVALID"
        ]
      },
      {
        "stage_id": "FAC-02-RCP_COMPILE",
        "name": "Compile Review Context Packs (RCP)",
        "purpose": "Generate deterministic, bounded context views for each gate role; maximize ZTI for consumption holons.",
        "inputs": [
          "changeset_digest",
          "ccp_atlas_hash",
          "pack_profiles",
          "impact_policy_profile"
        ],
        "outputs": [
          "rcp_quality_manifest_hash",
          "rcp_security_manifest_hash",
          "rcp_aat_manifest_hash",
          "run_receipt_hash"
        ],
        "actors": [
          "HOLON-CONTEXT-COMPILER"
        ],
        "invariants": [
          "Each RCP includes a View Commitment binding to ledger anchor + pinned repo/toolchain/policy digests.",
          "RCP manifests deep-pin stable IDs to content hashes (CAC).",
          "Impact Expansion is deterministic for same inputs; non-deterministic tools are prohibited in the compiler path."
        ],
        "defects_on_violation": [
          "RCP_NONDETERMINISTIC",
          "RCP_MISSING_VIEW_COMMITMENT"
        ]
      },
      {
        "stage_id": "FAC-03-MINT_AUTHORITY",
        "name": "Mint gate-scoped authority (GateLease)",
        "purpose": "Issue lease-scoped authority for a specific gate executor over a specific ChangeSetDigest.",
        "inputs": [
          "work_id",
          "changeset_digest",
          "gate_set",
          "executor_selection_policy"
        ],
        "outputs": [
          "gate_lease_issued_events",
          "run_receipt_hash"
        ],
        "actors": [
          "HOLON-KERNEL-GOVERNANCE",
          "HOLON-COORDINATOR"
        ],
        "invariants": [
          "GateLease scope is strict: (work_id, gate_id, changeset_digest, executor_actor_id, expiry, policy_hash).",
          "Lease issuance committed before session.spawn (CAS-at-commit ordering).",
          "Lease derivation obeys subset rule (child leases can only narrow)."
        ],
        "defects_on_violation": [
          "LEASE_SCOPE_BROADENED",
          "LEASE_NO_POLICY_HASH"
        ]
      },
      {
        "stage_id": "FAC-04-RUN_GATES",
        "name": "Run gates under OCAP context firewall",
        "purpose": "Execute quality/security/AAT gates; produce evidence bundles, gate receipts, and signed GateRunCompleted events.",
        "inputs": [
          "gate_lease",
          "rcp_manifest_hash",
          "tool_policy_profile",
          "target_profile"
        ],
        "outputs": [
          "evidence_bundle_hash",
          "gate_receipt_id",
          "gate_run_started_event",
          "gate_run_completed_event_signed",
          "run_receipt_hash",
          "defect_records?"
        ],
        "actors": [
          "HOLON-REVIEWER-QUALITY",
          "HOLON-REVIEWER-SECURITY",
          "HOLON-AAT"
        ],
        "invariants": [
          "OCAP context firewall: repo/file reads are allowed only for objects explicitly enumerated in the RCP manifest allowlist.",
          "Context misses are not 'warnings': they terminate the session with rationale CONTEXT_MISS and trigger refinement.",
          "GateRunCompleted is a critical signed event (Ed25519 over canonical bytes, domain-separated).",
          "GateReceipt binds to EvidenceBundle hash and is signed by GateReceiptGenerator.",
          "Advisory narratives are recorded but never substitute for terminal-verifier evidence."
        ],
        "defects_on_violation": [
          "CONTEXT_FIREWALL_DENY",
          "CONTEXT_MISS",
          "INVALID_SIGNATURE",
          "UNAUTHORIZED_EXECUTOR"
        ]
      },
      {
        "stage_id": "FAC-05-ADMISSION_DECISION",
        "name": "Admission decision + atomic merge",
        "purpose": "Decide promote/deny; on promote, perform atomic merge and emit MergeReceipt after observing trunk update.",
        "inputs": [
          "gate_run_completed_events",
          "gate_receipts",
          "policy_profile",
          "base_selector",
          "changeset_digest"
        ],
        "outputs": [
          "admission_decision",
          "merge_receipt_hash? (on success)",
          "run_receipt_hash"
        ],
        "actors": [
          "HOLON-KERNEL-GATE",
          "HOLON-GITHUB-ADAPTER (actuation)",
          "HOLON-COORDINATOR"
        ],
        "invariants": [
          "Admission reads only internal projections; never reads GitHub status as truth.",
          "Required gates must be satisfied by valid GateRunCompleted signatures + matching unexpired leases + matching ChangeSetDigest.",
          "Atomicity: MergeReceipt is emitted only after result_selector (trunk digest) is observed and recorded.",
          "MergeReceipt binds (base_selector, changeset_digest, gate_receipts, policy_hash) -> (result_selector)."
        ],
        "defects_on_violation": [
          "GATE_MISSING",
          "GATE_STALE_SHA",
          "MERGE_NONATOMIC",
          "MERGE_RECEIPT_INVALID"
        ]
      },
      {
        "stage_id": "FAC-06-PROJECTION_SYNC",
        "name": "Projection sync + anti-entropy watchdog",
        "purpose": "Project authoritative state to GitHub; detect and react to divergence.",
        "inputs": [
          "ledger_head",
          "projection_targets",
          "latest_merge_receipt"
        ],
        "outputs": [
          "projection_receipt_hash",
          "projection_health",
          "defect_records?"
        ],
        "actors": [
          "HOLON-GITHUB-ADAPTER"
        ],
        "invariants": [
          "Sync direction is always ledger -> GitHub.",
          "Projection is idempotent; repeated sync yields same GitHub state.",
          "Adapter is the only identity permitted to write GitHub checks/status/labels/comments.",
          "Continuous divergence detection: compare external trunk HEAD to latest MergeReceipt result_selector; if diverged, emit PROJECTION_DIVERGENCE and freeze admissions for that repo."
        ],
        "defects_on_violation": [
          "PROJECTION_TAMPER",
          "PROJECTION_DIVERGENCE",
          "PROJECTION_WRITE_UNAUTHORIZED"
        ]
      }
    ],
    "stop_conditions": {
      "boundedness": {
        "per_gate_max_attempts": 3,
        "global_max_episodes": 50,
        "budgets": {
          "review_security": {
            "tokens": 250000,
            "tool_calls": 800,
            "duration_ms": 3600000
          },
          "review_quality": {
            "tokens": 250000,
            "tool_calls": 800,
            "duration_ms": 3600000
          },
          "aat": {
            "tokens": 200000,
            "tool_calls": 1000,
            "duration_ms": 3600000
          }
        }
      },
      "echo_trap_detection": {
        "signal": "FindingSignature repeats without delta",
        "threshold": 3,
        "window": "single GateRun",
        "action": [
          "Terminate session rationale=REASONING_DEGENERATION",
          "Emit DefectRecord(ECHO_TRAP)",
          "Escalate via OracleRequest or AdjudicationRequested(request_type=GATE_REVIEW)"
        ]
      },
      "retry_policy": {
        "backoff": "exponential",
        "max_backoff_seconds": 3600,
        "provider_errors": "classified into retryable/non-retryable; see provider_routing"
      }
    },
    "optional_extensions": {
      "phase2": {
        "stage_id": "FAC-90-HOLDOUT_AUDIT",
        "name": "Adversarial holdout / drift audit (Phase 2)",
        "purpose": "Measure false negatives and evaluator drift using known-bad ChangeSets and sampled audits.",
        "inputs": [
          "holdout_suite_id",
          "gate_policy_version",
          "sampling_policy"
        ],
        "outputs": [
          "evaluator_metrics",
          "drift_alerts",
          "policy_quarantine?"
        ],
        "actors": [
          "HOLON-AUDITOR"
        ],
        "invariants": [
          "Holdout ChangeSets are isolated from production trunk (no merge capability).",
          "If false-negative rate exceeds threshold, gate policy is quarantined and admission requires explicit adjudication until resolved."
        ],
        "defects_on_violation": [
          "EVALUATOR_DRIFT",
          "HOLDOUT_FALSE_NEGATIVE"
        ]
      }
    }
  },
  "authority": {
    "identity": {
      "keys": {
        "algorithm": "ed25519",
        "binding": "KeyRotated establishes actor_id -> verifying_key with chain-of-custody",
        "domain_separators": {
          "gate_run_completed": "GATE_RUN_COMPLETED:",
          "gate_lease": "GATE_LEASE_ISSUED:",
          "merge_receipt": "MERGE_RECEIPT:",
          "ci_import_attestation": "CI_IMPORT_ATTESTATION:",
          "projection_receipt": "PROJECTION_RECEIPT:"
        },
        "ingestion": {
          "critical_events_must_verify": true,
          "reject_reason_codes": [
            "INVALID_SIGNATURE",
            "UNAUTHORIZED_EXECUTOR",
            "UNKNOWN_KEY"
          ]
        }
      }
    },
    "roles": [
      {
        "role_id": "ROLE_IMPLEMENTER",
        "holons": [
          "HOLON-WORK-EXECUTOR"
        ],
        "may": [
          "produce changesets",
          "publish implementation evidence"
        ],
        "may_not": [
          "sign GateRunCompleted for required gates",
          "emit MergeReceipt",
          "write external projections"
        ]
      },
      {
        "role_id": "ROLE_REVIEWER_SECURITY",
        "holons": [
          "HOLON-REVIEWER-SECURITY"
        ],
        "may": [
          "sign GateRunCompleted for gate=security under valid lease",
          "publish findings evidence"
        ],
        "may_not": [
          "merge",
          "write external projections"
        ]
      },
      {
        "role_id": "ROLE_REVIEWER_QUALITY",
        "holons": [
          "HOLON-REVIEWER-QUALITY"
        ],
        "may": [
          "sign GateRunCompleted for gate=quality under valid lease",
          "publish findings evidence"
        ],
        "may_not": [
          "merge",
          "write external projections"
        ]
      },
      {
        "role_id": "ROLE_AAT_VERIFIER",
        "holons": [
          "HOLON-AAT"
        ],
        "may": [
          "sign GateRunCompleted for gate=aat under valid lease",
          "publish AAT receipts"
        ],
        "may_not": [
          "merge",
          "write external projections"
        ]
      },
      {
        "role_id": "ROLE_ADMISSION",
        "holons": [
          "HOLON-KERNEL-GATE"
        ],
        "may": [
          "emit MergeReceipt",
          "deny admission",
          "request adjudication",
          "freeze admissions"
        ],
        "may_not": [
          "alter reviewer findings",
          "forge gate outcomes"
        ]
      },
      {
        "role_id": "ROLE_PROJECTION",
        "holons": [
          "HOLON-GITHUB-ADAPTER"
        ],
        "may": [
          "project internal state to GitHub",
          "import CI logs/artifacts as evidence"
        ],
        "may_not": [
          "decide admission truth"
        ]
      }
    ],
    "gate_lease": {
      "fields": [
        "lease_id",
        "work_id",
        "gate_id",
        "changeset_digest",
        "executor_actor_id",
        "issued_at",
        "expires_at",
        "policy_hash",
        "issuer_actor_id",
        "issuer_signature"
      ],
      "single_use": true,
      "expiry_enforced": true,
      "lease_outcome_binding": "GateRunCompleted must reference lease_id and include changeset_digest; mismatch rejects.",
      "coi_enforcement": "see conflict_of_interest"
    },
    "conflict_of_interest": {
      "enabled": true,
      "rule": "Executor of a required gate must not be the author of the ChangeSet (or a key in the same COI group).",
      "coi_grouping": "Keys may be grouped by custody domain; COI is enforced at group-level.",
      "waiver": {
        "enabled": true,
        "path": "AdjudicationRequested request_type=WAIVER with explicit rationale and bounded scope; signed by authority set",
        "scope_fields": [
          "work_id",
          "changeset_digest",
          "gate_id",
          "expires_at",
          "rationale"
        ]
      }
    }
  },
  "ocap_and_context": {
    "mode": "ZTI-first consumption",
    "context_firewall": {
      "mechanism": "OCAP mediated tools with manifest-scoped read handles",
      "rules": [
        {
          "rule_id": "CTX-ALLOWLIST-001",
          "statement": "repo.read and file.read operations must reference a manifest entry (stable_id or path+hash) present in the ContextPackManifest allowlist.",
          "enforcement": "ToolDecided=DENY if not allowlisted",
          "severity": "S1"
        },
        {
          "rule_id": "CTX-ZOOM-001",
          "statement": "Consumers may request additional context only via ContextRefinementRequest, which terminates current session and triggers pack recompilation; no in-session discovery.",
          "enforcement": "SessionTerminated rationale=CONTEXT_MISS; coordinator reissues lease after refined pack is produced.",
          "severity": "S1"
        },
        {
          "rule_id": "CTX-SUFFICIENCY-001",
          "statement": "Every RunReceipt records context sufficiency metrics (bytes supplied, entries used, misses, denied reads, ZTI score).",
          "enforcement": "RunReceipt required for GateRunCompleted acceptance",
          "severity": "S2"
        }
      ],
      "defect_emission": {
        "on_denied_read": "CONTEXT_FIREWALL_DENY",
        "on_context_miss": "CONTEXT_MISS (triggers refinement loop)",
        "on_excessive_zoom_requests": "REASONING_DEGENERATION"
      }
    },
    "tool_policy": {
      "default": "deny",
      "per_role_allowlists": {
        "HOLON-REVIEWER-SECURITY": [
          "cas.get",
          "repo.read_allowlisted",
          "cargo.test",
          "dep.audit",
          "policy.scan",
          "artifact.fetch"
        ],
        "HOLON-REVIEWER-QUALITY": [
          "cas.get",
          "repo.read_allowlisted",
          "cargo.test",
          "cargo.clippy",
          "rustfmt.check",
          "artifact.fetch"
        ],
        "HOLON-AAT": [
          "cas.get",
          "repo.read_allowlisted",
          "shell.exec_allowlisted",
          "cargo.test",
          "artifact.fetch"
        ],
        "HOLON-COORDINATOR": [
          "ledger.append",
          "ledger.read",
          "session.spawn",
          "cas.put",
          "cas.get",
          "policy.query"
        ],
        "HOLON-GITHUB-ADAPTER": [
          "github.write",
          "github.read_limited",
          "artifact.fetch",
          "cas.put",
          "cas.get",
          "ledger.read"
        ]
      },
      "ambient_credential_ban": [
        "No agent processes inherit GitHub tokens/ssh keys; only adapter has projection credentials.",
        "Any attempt to access forbidden credentials emits PolicyViolation and quarantines session."
      ]
    }
  },
  "ci_ingestion": {
    "trusted_boundary": "GitHub webhook signature verifies origin but is not sufficient for readiness/admission.",
    "evidence_binding": {
      "required_for_ready_for_review": "when_ci_gating_enabled",
      "raw_import": [
        "workflow logs (compressed)",
        "test reports/artifacts",
        "workflow metadata (run id, job ids)"
      ],
      "attestation": {
        "level": "L1",
        "fields": [
          "runner_image_digest?",
          "toolchain?",
          "command_transcript_hash?",
          "workflow_run_id",
          "downloaded_artifact_hashes"
        ],
        "signed_by": "HOLON-GITHUB-ADAPTER"
      }
    },
    "open_question": "How to obtain stable runner image digests from hosted CI; may require self-hosted runners for L1+.",
    "feature_flags": {
      "CI_EVENTS_ENABLED": "false by default (fail-closed); when true, evidence-backed import is required",
      "CI_GATED_QUEUE_ENABLED": "false by default (fail-closed); when true, READY_FOR_REVIEW transitions require attested evidence import"
    },
    "security_notes": [
      "CI conclusions are treated as observations; admission requires internal gates that use terminal verifiers with attested evidence.",
      "Where hosted CI cannot provide strong environment attestations, re-run critical verifiers in controlled environments for high-risk changes (T3)."
    ]
  },
  "projection": {
    "projection_only": true,
    "write_identity": "HOLON-GITHUB-ADAPTER",
    "idempotence": "Projection keyed by (work_id, changeset_digest, ledger_head) fingerprint; reapply is safe.",
    "tamper_detection": {
      "status_write_policy": "Only adapter token may write checks/status; other writers treated as tamper.",
      "tamper_reaction": [
        "Optionally set external checks to FAILURE on tamper detection to prevent human reliance on stale green UI.",
        "Overwrite projection to match ledger truth on next sync",
        "Emit DefectRecord(PROJECTION_TAMPER) with evidence (diff of fingerprints)"
      ]
    },
    "divergence_watchdog": {
      "check": "Compare external trunk HEAD commit/tree to latest internal MergeReceipt result_selector.",
      "poll_interval_seconds": 30,
      "on_divergence": [
        "Emit DefectRecord(PROJECTION_DIVERGENCE) with observed head + expected head",
        "Emit InterventionFreeze(scope=repo) and halt new FAC admissions for repo",
        "Open AdjudicationRequested(request_type=EMERGENCY_RECOVERY) referencing divergence evidence"
      ],
      "unfreeze": "Requires explicit adjudication or emergency override ceremony per PRD-0007 emergency_override."
    },
    "branch_protection_contract": {
      "goal": "Ensure external merge paths cannot bypass FAC admission.",
      "requirements": [
        "Main branch protection requires checks that are only set by HOLON-GITHUB-ADAPTER.",
        "Restrict merge permissions so only adapter identity (or merge bot) can merge to main.",
        "Disable 'administrator bypass' for routine operations; if kept, treat use as emergency override with audit."
      ],
      "open_question": "Exact GitHub org policies and enforcement mechanics; document and codify in adapter handshake."
    }
  },
  "goodhart_resistance": {
    "enabled": false,
    "holdouts": {
      "concept": "Known-bad ChangeSets and adversarial suites routed through gate pipeline to estimate false-negative rates.",
      "execution": "HOLON-AUDITOR runs FAC-90-HOLDOUT_AUDIT on schedule; cannot merge.",
      "metrics": [
        "false_negative_rate",
        "finding_precision",
        "gate_evidence_coverage"
      ]
    },
    "evaluator_audit": {
      "concept": "Sample GateRunCompleted + EvidenceBundle pairs and verify rationale codes align with raw evidence (LAW-15).",
      "sampling": {
        "rate": "1% of GateRuns or min 1/day",
        "bias": "oversample security-sensitive changes"
      },
      "actions_on_drift": [
        "Quarantine affected gate policy version",
        "Require adjudication for affected gate until resolved"
      ]
    },
    "activation_phase": "Phase 2",
    "policy": "Holdouts/audits are measurement channels isolated from admission objectives; they can quarantine policies but do not auto-merge or auto-block in Phase 1."
  },
  "defects": {
    "schema": "cac.defect_record.v1",
    "taxonomy": [
      {
        "code": "PROJECTION_TAMPER",
        "severity": "S1",
        "description": "External projection mutated by non-adapter identity"
      },
      {
        "code": "PROJECTION_DIVERGENCE",
        "severity": "S0",
        "description": "External trunk diverges from latest MergeReceipt"
      },
      {
        "code": "CI_EVIDENCE_MISSING",
        "severity": "S1",
        "description": "CI readiness transition attempted without imported raw evidence digests"
      },
      {
        "code": "CONTEXT_MISS",
        "severity": "S2",
        "description": "Pack lacks required context; session terminated; triggers refinement loop"
      },
      {
        "code": "CONTEXT_FIREWALL_DENY",
        "severity": "S2",
        "description": "Attempted read outside pack allowlist"
      },
      {
        "code": "INVALID_SIGNATURE",
        "severity": "S0",
        "description": "Critical event signature invalid"
      },
      {
        "code": "UNAUTHORIZED_EXECUTOR",
        "severity": "S0",
        "description": "Gate outcome signed by actor not authorized/leased"
      },
      {
        "code": "ECHO_TRAP",
        "severity": "S2",
        "description": "Reasoning degeneration detected (repeated finding signatures)"
      },
      {
        "code": "PROVIDER_RATE_LIMIT",
        "severity": "S3",
        "description": "LLM provider rate limiting impacted run"
      },
      {
        "code": "PROVIDER_TIMEOUT",
        "severity": "S3",
        "description": "LLM provider timeout impacted run"
      },
      {
        "code": "EVALUATOR_DRIFT",
        "severity": "S1",
        "description": "Auditor detected drift between rationale codes and evidence"
      },
      {
        "code": "HOLDOUT_FALSE_NEGATIVE",
        "severity": "S1",
        "description": "Gate missed known-bad holdout vulnerability/bug"
      }
    ],
    "generation_sources": [
      "ToolDecided DENY",
      "SessionTerminated rationale codes",
      "Provider error classification from ToolExecuted",
      "Projection watchdog events",
      "Gate audit/holdout metrics"
    ],
    "linkage": "DefectRecord links to (work_id, session_id, gate_id, changeset_digest) and evidence hashes.",
    "phase2_only_codes": [
      "EVALUATOR_DRIFT",
      "HOLDOUT_FALSE_NEGATIVE"
    ]
  },
  "provider_routing": {
    "classification_aware": true,
    "stage_scoped": true,
    "error_taxonomy": [
      "RATE_LIMIT",
      "TIMEOUT",
      "TRANSIENT_5XX",
      "INVALID_RESPONSE",
      "POLICY_DENY"
    ],
    "circuit_breaker": {
      "thresholds": {
        "RATE_LIMIT": 3,
        "TIMEOUT": 2,
        "TRANSIENT_5XX": 2
      },
      "ttl_ms": 900000,
      "reset_on_success": true
    },
    "recording": "All provider routing decisions and errors are recorded in ToolDecided/ToolExecuted receipts and normalized into DefectRecords.",
    "fallback_policy": "Deterministic routing profile per stage with ordered fallbacks; emits routing rationale.",
    "open_issue": "Cross-provider prompt equivalence & data classification constraints."
  },
  "milestones": [
    {
      "phase": "Phase 1 (FAC Core Hardening)",
      "deliverables": [
        "New gate events (GateLeaseIssued, GateRunStarted, GateRunCompleted) with mandatory signature verification on ingestion.",
        "OCAP context firewall enforced mechanically for CONSUME holons.",
        "GitHub adapter projection-only; status setters outside adapter removed from skills and denied by policy.",
        "Projection divergence watchdog + freeze/unfreeze path."
      ],
      "definition_of_done": [
        "An autonomous agent cannot flip a gate outcome or merge by manipulating GitHub or xtask; it must produce signed internal events and receipts.",
        "A GateRun cannot proceed with missing context; it terminates and triggers pack refinement."
      ]
    },
    {
      "phase": "Phase 2 (Measurement Integrity + Goodhart Resistance)",
      "deliverables": [
        "Holdout suite runner (known-bad changes) to measure false negatives.",
        "Auditor sampling of gate outcomes vs evidence; drift alerts and policy quarantine.",
        "Echo-trap metrics feeding instruction and pack compiler updates."
      ]
    },
    {
      "phase": "Phase 3 (Autonomous Improvement Substrate)",
      "deliverables": [
        "Defect-driven auto-tuning of pack specs and instructions under CAC governance.",
        "Provider routing improvements with safe fallback and classification-aware routing."
      ]
    }
  ],
  "open_questions": [
    {
      "id": "FAC-OQ-0001",
      "question": "Canonical proto placement for new gate/projection/intervention events",
      "notes": [
        "Option A: extend kernel_events.proto with GateEvent and ProjectionEvent payloads.",
        "Option B: encode as EvidenceEvent + metadata; simpler but weaker typing."
      ],
      "recommendation": "Prefer typed GateEvent/ProjectionEvent payloads (security-critical)."
    },
    {
      "id": "FAC-OQ-0002",
      "question": "Deterministic impact expansion for Rust (call graph, trait impl fanout) within pinned toolchains",
      "notes": [
        "Baseline grep/symbol scan",
        "rust-analyzer indexing (deterministic snapshot)"
      ]
    },
    {
      "id": "FAC-OQ-0003",
      "question": "Formal COI grouping policy (e.g., key custody domains) and interaction with delegation",
      "notes": [
        "Need explicit KeyPolicy artifact under CAC."
      ]
    }
  ],
  "appendix": {
    "new_event_shapes": {
      "proto_changes_required": [
        {
          "payload_family": "GateEvent",
          "messages": [
            "GateLeaseIssued (critical, signed by governance)",
            "GateRunStarted (non-critical, unsigned ok)",
            "GateRunCompleted (critical, signed by gate executor; includes evidence_bundle_hash, gate_receipt_id, lease_id, changeset_digest)"
          ],
          "canonicalization": "No maps; sort repeated fields before signing; domain-separated signatures."
        },
        {
          "payload_family": "ProjectionEvent",
          "messages": [
            "ProjectionApplied (receipt-backed sync attempt)",
            "ProjectionDiverged (critical; triggers freeze)",
            "ProjectionTamperObserved (defect signal)"
          ]
        },
        {
          "payload_family": "InterventionEvent",
          "messages": [
            "InterventionFreeze (repo/work scope, signed by admission authority)",
            "InterventionUnfreeze (signed; may require adjudication/override ceremony)"
          ]
        }
      ]
    }
  }
}
