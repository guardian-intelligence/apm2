{
  "$id": "bootstrap:patch_record.v1",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Bootstrap Patch Record v1",
  "description": "Record of a patch operation targeting a CAC artifact. Bootstrap schemas cannot be patched.",
  "type": "object",
  "properties": {
    "record_type": {
      "type": "string",
      "const": "patch_record"
    },
    "record_version": {
      "type": "string",
      "pattern": "^v[0-9]+$"
    },
    "record_id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 256,
      "pattern": "^[A-Za-z0-9_.:-]+$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time"
    },
    "actor_id": {
      "type": "string",
      "minLength": 1
    },
    "work_id": {
      "type": "string",
      "minLength": 1
    },
    "target": {
      "type": "object",
      "properties": {
        "stable_id": {
          "description": "Target artifact stable ID. MUST NOT start with 'bootstrap:'",
          "type": "string"
        },
        "expected_base_hash": {
          "type": "string",
          "pattern": "^b3-256:[0-9a-f]{64}$"
        }
      },
      "required": ["stable_id", "expected_base_hash"],
      "unevaluatedProperties": false
    },
    "patch_kind": {
      "type": "string",
      "enum": ["json_patch_rfc6902", "json_merge_patch_rfc7396"]
    },
    "patch": {
      "description": "The patch content (format depends on patch_kind)."
    },
    "schema_ref": {
      "type": "object",
      "properties": {
        "schema_id": {
          "type": "string"
        },
        "schema_hash": {
          "type": "string",
          "pattern": "^b3-256:[0-9a-f]{64}$"
        }
      },
      "required": ["schema_id"],
      "unevaluatedProperties": false
    },
    "evidence_refs": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^b3-256:[0-9a-f]{64}$"
      }
    },
    "justification_code": {
      "type": "string"
    },
    "signature": {
      "type": "string"
    }
  },
  "required": [
    "record_type",
    "record_version",
    "record_id",
    "timestamp",
    "actor_id",
    "work_id",
    "target",
    "patch_kind",
    "patch"
  ],
  "unevaluatedProperties": false
}
